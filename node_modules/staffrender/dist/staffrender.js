!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(1);window.sr=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}(i(2))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=i(3),a=i(4),r=i(5),h=[{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,0,1,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,0,3,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,2,0,0,2,0,2,0,0,3]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-7],accidental:[3,0,3,0,3,0,0,3,0,3,0,0]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,2,0,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,3,0,0]}],o=[{accidental:1,pitches:[]},{accidental:2,pitches:[70,75,68,73,66]},{accidental:1,pitches:[78,73]},{accidental:2,pitches:[70,75,68]},{accidental:1,pitches:[78,73,80,75]},{accidental:2,pitches:[70]},{accidental:2,pitches:[70,75,68,73,66,71]},{accidental:1,pitches:[78]},{accidental:2,pitches:[70,75,68,73]},{accidental:1,pitches:[78,73,80]},{accidental:2,pitches:[70,75]},{accidental:1,pitches:[78,73,80,75,70]}];e.MAX_QUARTER_DIVISION=16,function(t){t[t.PAGE=0]="PAGE",t[t.NOTE=1]="NOTE",t[t.BAR=2]="BAR"}(s=e.ScrollType||(e.ScrollType={}));var l=function(){function t(t,e,i){var a=this;this.handleScrollEvent=function(t){a.lastKnownScrollLeft=a.parentElement.scrollLeft,a.ticking||window.requestAnimationFrame((function(){a.changeAndDrawSignaturesIfNeeded(a.lastKnownScrollLeft),a.ticking=!1})),a.ticking=!0},this.scoreInfo=t;this.config={noteHeight:e.noteHeight||6,noteSpacing:e.noteSpacing||1,pixelsPerTimeStep:e.pixelsPerTimeStep||30,noteRGB:e.noteRGB||"8, 41, 64",activeNoteRGB:e.activeNoteRGB||"240, 84, 119"},this.div=i,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.key=e.defaultKey||0,this.scrollType=e.scrollType||s.PAGE,this.scale=this.config.noteHeight/r.PATH_SCALE,(void 0===e.pixelsPerTimeStep||e.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0,this.config.noteSpacing=n.COMPACT_SPACING*this.scale),this.clear(),this.redraw()}return t.prototype.clear=function(){for(;this.div.lastChild;)this.div.removeChild(this.div.lastChild);this.div.style.overflow="visible",this.div.style.position="relative",this.overlaySVG=document.createElementNS(a.SVGNS,"svg"),this.overlaySVG.style.position="absolute",this.div.appendChild(this.overlaySVG),this.overlayG=a.createSVGGroupChild(this.overlaySVG,"overlay"),this.signaturesBlinking=!1,this.signaturesQuarters=0,this.parentElement=document.createElement("div"),this.parentElement.style.overflow="auto",this.div.appendChild(this.parentElement),this.ticking=!1,this.lastKnownScrollLeft=0,this.parentElement.addEventListener("scroll",this.handleScrollEvent),this.staffSVG=document.createElementNS(a.SVGNS,"svg"),this.parentElement.appendChild(this.staffSVG),this.staffG=a.createSVGGroupChild(this.staffSVG,"staff"),this.linesG=a.createSVGGroupChild(this.staffSVG,"lines"),this.setStroke(this.linesG),this.staffG.appendChild(this.linesG),this.musicG=a.createSVGGroupChild(this.staffSVG,"music"),this.setFill(this.musicG),this.setStroke(this.musicG,0),this.staffG.appendChild(this.musicG),this.signaturesG=a.createSVGGroupChild(this.staffSVG,"signatures"),this.staffG.appendChild(this.signaturesG);var t=0,e=0;this.scoreInfo.notes.forEach((function(i){t+=i.pitch,++e}));var i=t/e;this.clef=i<60?50:71,this.signaturesList=[{x:0,q:0}],this.signatureCurrent=0,this.signatureNext=0,this.changeKeySignatureIfNeeded(0),this.changeTimeSignatureIfNeeded(0),this.vStepSize=this.config.noteHeight/2,this.hStepSize=this.config.pixelsPerTimeStep,this.staffOffset=0,this.height=0,this.width=0,this.musicBlockMap=new Map,this.playingNotes=[],this.lastBar=0,this.barAccidentals={},this.lastQ=-1},t.prototype.isPaintingActiveNote=function(t,e){var i=t.start===e.start,s=t.start<=e.start&&t.start+t.length>=e.start+e.length;return i||s},t.prototype.redraw=function(t,e){var i=this,n=-1,r=0===this.config.pixelsPerTimeStep;if(t){var h=[];this.playingNotes.forEach((function(e){i.isPaintingActiveNote(e,t)?h.push(e):i.highlightElement(i.getGroup(e),!1)})),this.playingNotes=h;var o=this.getGroup(t);if(o){this.playingNotes.push(t),this.highlightElement(o,!0),n=o.getBoundingClientRect().left-this.staffSVG.getBoundingClientRect().left;var l=t.start,c=o.getAttribute("data-is-bar-beginning");(this.scrollType!==s.BAR||c)&&this.scrollIntoViewIfNeeded(e,n),!r&&this.signaturesBlinking&&l>=this.signaturesQuarters&&(this.signaturesBlinking=!1,a.setFade(this.overlayG,this.signaturesBlinking))}}else{this.setDetails();var u=-1===this.lastQ,d=0,p=0;u?(p=this.drawSignatures(this.overlayG,d,!0,!0,!0),r&&(this.width=0,p+=this.config.noteSpacing),p+=this.drawRests(this.initialRest,d+p)):d=this.width,this.musicBlockMap.forEach((function(t,e){r||(d=i.quartersToTime(e)*i.hStepSize),e>i.lastQ?(p+=i.drawMusicBlock(t,d+p),i.lastQ=e):e===i.lastQ&&(p+=i.drawRests(t,d+p))}));var f=this.staffSVG.getBoundingClientRect(),g=this.musicG.getBoundingClientRect();if(this.updateVerticalBoundaries(g.top-f.top,g.bottom-f.top),r)this.width+=p;else{var S=this.musicBlockMap.get(this.lastQ),m=this.quartersToTime(this.lastQ+S.notes[0].length);this.width=m*this.config.pixelsPerTimeStep}this.staffSVG.setAttributeNS(null,"width",""+this.width),this.redrawStaff(this.linesG,0,this.width)}return n},t.prototype.drawMusicBlock=function(t,e){var i=this,s=t.notes[0].start,h=this.drawBarIfNeeded(s,e);h+=this.drawSignaturesIfNeeded(s,e+h);for(var o=0,l=4;l>=n.MIN_RESOLUTION&&!o;l/=2)l<=t.notes[0].length&&(o=l);if(0===o){var c=0===t.notes[0].length?"[infinite]":""+4/t.notes[0].length;console.warn(" StaffRender ","background:orange; color:white","StaffRender does not handle notes shorther than 1/"+4/n.MIN_RESOLUTION+"th, and this score tries to draw a 1/"+c+"th. Shortest possible note will be drawn instead."),o=n.MIN_RESOLUTION}var u,d=r.NOTE_PATHS[o];if(d.stemAnchor&&(u=a.createSVGGroupChild(this.musicG,"stem")),t.notes.forEach((function(s){for(var n=s.vSteps*i.vStepSize,l=2*(s.vSteps>0?Math.floor(s.vSteps/2):Math.ceil(s.vSteps/2)),c=s.vSteps>0?-2:2,u=l;Math.abs(u)>4;u+=c)a.drawSVGPath(i.linesG,r.extraLinePath,e+h,u*i.vStepSize,i.scale,1);if(s.g=s.tiedFrom?s.tiedFrom.g:a.createSVGGroupChild(i.musicG,s.start+"-"+s.pitch),t.isBarBeginning&&s.g.setAttribute("data-is-bar-beginning","true"),s.tiedFrom){var p=e+h-s.tiedFrom.xHeadRight;a.drawSVGPath(s.g,r.tiePath,s.tiedFrom.xHeadRight,n,p/r.PATH_SCALE,i.scale*(s.vSteps<0?-1:1),s.opacity)}a.drawSVGPath(s.g,d.path,e+h,n,i.scale,i.scale,s.opacity),s.xHeadRight=e+h+d.width*i.scale,1.5*o<=s.length&&a.drawSVGPath(s.g,r.dotPath,e+h+d.width*i.scale+i.vStepSize/2,n-i.vStepSize/2,i.scale,i.scale,s.opacity),0!==s.accidental&&a.drawSVGPath(s.g,r.ACCIDENTAL_PATHS[s.accidental],e+h,n,i.scale,i.scale,s.opacity)})),d.stemAnchor){var p=e+h,f=void 0,g=void 0,S=d.stemAnchor*this.scale,m=t.minVStep+t.maxVStep<0,v=d.flags>2?2*(d.flags-2):0;if(m?(f=t.maxVStep*this.vStepSize-S,g=(t.minVStep+7+v)*this.vStepSize):(p+=(d.width-n.STEM_WIDTH)*this.scale,f=t.minVStep*this.vStepSize+S,g=(t.maxVStep-7-v)*this.vStepSize),a.drawSVGPath(u,r.stemPath,p,f,this.scale,(g-f)/r.PATH_SCALE),1===d.flags)a.drawSVGPath(u,r.singleFlagPath,p,g,this.scale,this.scale*(m?-1:1),1);else if(d.flags>1)for(l=0;l<d.flags;++l)a.drawSVGPath(u,r.multiFlagPath,p,g,this.scale,this.scale*(m?-1:1),1),g+=(m?-2:2)*this.vStepSize}return 0===this.config.pixelsPerTimeStep&&(h+=d.width*this.scale,u&&(h+=u.getBoundingClientRect().width),h+=this.config.noteSpacing),h+=this.drawRests(t,e+h)},t.prototype.drawBarIfNeeded=function(t,e){var i=0,s=this.lastBar+this.getBarLength();return 0!==t&&t>=s&&(this.config.pixelsPerTimeStep>0?e-=this.config.noteSpacing:i=this.config.noteSpacing,a.drawSVGPath(this.linesG,r.barPath,e,0,1,this.scale),this.lastBar=s),i},t.prototype.drawRests=function(t,e){var i=0,s=t.restToNextLength;if(s){this.config.pixelsPerTimeStep>0&&(e+=this.quartersToTime(t.notes[0].length)*this.hStepSize);var h=t.notes[0].start+t.notes[0].length,o=0,l=this.lastBar+this.getBarLength()-h;s>l&&(o=s-l,s=l);var c=void 0;for(c=4;c>this.getBarLength()&&c>=n.MIN_RESOLUTION;c/=2);for(var u=c;(s||o)&&u>=n.MIN_RESOLUTION;){if(u<=s){i+=this.drawBarIfNeeded(h,e+i),i+=this.drawSignaturesIfNeeded(h,e+i);var d=a.drawSVGPath(this.musicG,r.REST_PATHS[u],e+i,0,this.scale,this.scale);this.config.pixelsPerTimeStep>0?e+=this.quartersToTime(u)*this.hStepSize:(i+=d.getBoundingClientRect().width,i+=this.config.noteSpacing),h+=u,s-=u}if(o&&s<=0){var p=this.getBarLength();for(o>p?(s=p,o-=p):(s=o,o=0),c=4;c>this.getBarLength()&&c>=n.MIN_RESOLUTION;c/=2);u=c}s<u&&(u/=2)}}return i},t.prototype.redrawStaff=function(t,e,i){var s=t.querySelector('g[data-id="staff-five-lines"]');if(s)s.setAttributeNS(null,"transform","scale("+i/r.PATH_SCALE+", 1)");else{s=a.createSVGGroupChild(t,"staff-five-lines");for(var n=-4;n<=4;n+=2)a.drawSVGPath(s,r.staffLinePath,e,0+n*this.vStepSize,i/r.PATH_SCALE,1)}return s},t.prototype.clearSignatureOverlay=function(){for(;this.overlayG.lastChild;)this.overlayG.removeChild(this.overlayG.lastChild)},t.prototype.drawSignaturesIfNeeded=function(t,e){var i=0,s=this.changeKeySignatureIfNeeded(t),r=this.changeTimeSignatureIfNeeded(t);if(s||r){var h=n.COMPACT_SPACING*this.scale*(this.config.pixelsPerTimeStep>0?3:2);this.signaturesList.push({x:e-h,q:t}),null===this.signatureNext&&(this.signatureNext=e);var o=t>0?a.createSVGGroupChild(this.signaturesG,"signatures"):this.overlayG;i+=this.drawSignatures(o,e+i,!1,s,r)}return 0===this.config.pixelsPerTimeStep?i:0},t.prototype.drawSignatures=function(t,e,i,s,h){var l,c=this,u=n.COMPACT_SPACING*this.scale,d=u,p=t===this.overlayG||this.config.pixelsPerTimeStep>0;if(p){(l=document.createElementNS(a.SVGNS,"rect")).setAttributeNS(null,"x",""+e),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width","1"),l.setAttributeNS(null,"height","1"),l.setAttribute("data-id","background"),t.appendChild(l);var f=document.defaultView.getComputedStyle(this.div.parentElement);l.setAttributeNS(null,"fill",f.getPropertyValue("background-color"))}if(i){var g=a.drawSVGPath(t,r.CLEF_PATHS[this.clef].path,e+d,0,this.scale,this.scale);this.setFill(g),d+=3*u}if(s){var S=o[this.key].accidental,m=71===this.clef?0:14;o[this.key].pitches.forEach((function(i){var s=c.getPitchDetails(i).vSteps,n=a.drawSVGPath(t,r.ACCIDENTAL_PATHS[S],e+d,(m+s)*c.vStepSize,c.scale,c.scale);c.setFill(n),d+=n.getBoundingClientRect().width}))}if(h){var v=a.createSVGGroupChild(t,"time-key"),y=2.85*this.config.noteHeight+"px";a.drawSVGText(v,""+this.timeSignatureNumerator,e+d,-.5,y,!0),a.drawSVGText(v,""+this.timeSignatureDenominator,e+d,4*this.vStepSize-.5,y,!0),this.setFill(v),d+=v.getBoundingClientRect().width+u}var N=this.redrawStaff(t,e,d);this.setStroke(N);var G=this.div.getBoundingClientRect(),A=t.getBoundingClientRect();if(this.updateVerticalBoundaries(A.top-G.top,A.bottom-G.top),p&&(l.setAttributeNS(null,"y",""+-this.staffOffset),l.setAttributeNS(null,"height",""+this.height),l.setAttributeNS(null,"width",""+d)),t===this.overlayG){this.overlaySVG.setAttributeNS(null,"width",""+(d+5));for(var w=0;w<5;++w){var T=a.drawSVGPath(t,r.stemPath,d+w,w*w-this.staffOffset,1/n.STEM_WIDTH,(this.height-2*w*w)/r.PATH_SCALE,(w-5)*(w-5)*2/r.PATH_SCALE);this.setFill(T)}}if(this.config.pixelsPerTimeStep>0){var P=0===this.signaturesQuarters;return P&&(this.signaturesQuarters=this.timeToQuarters(d/this.hStepSize)),(P||e>0)&&(this.signaturesBlinking=!0,a.setFade(t,this.signaturesBlinking)),0}return d},t.prototype.changeKeySignatureIfNeeded=function(t){if(this.scoreInfo.keySignatures){for(var e=this.key,i=0;i<this.scoreInfo.keySignatures.length&&this.scoreInfo.keySignatures[i].start<=t;++i)e=this.scoreInfo.keySignatures[i].key;if(e!==this.key)return this.key=e,!0}return!1},t.prototype.changeTimeSignatureIfNeeded=function(t){if(this.scoreInfo.timeSignatures){for(var e=this.timeSignatureNumerator,i=this.timeSignatureDenominator,s=0;s<this.scoreInfo.timeSignatures.length&&this.scoreInfo.timeSignatures[s].start<=t;++s)e=this.scoreInfo.timeSignatures[s].numerator,i=this.scoreInfo.timeSignatures[s].denominator;if(e!==this.timeSignatureNumerator||i!==this.timeSignatureDenominator)return this.timeSignatureNumerator=e,this.timeSignatureDenominator=i,!0}return!1},t.prototype.changeAndDrawSignaturesIfNeeded=function(t){var e;if(t<this.signatureCurrent||null!==this.signatureNext&&this.signatureNext<=t){e=this.signaturesList[0].q,this.signatureNext=null;for(var i=0;i<this.signaturesList.length;++i){if(t<this.signaturesList[i].x){this.signatureNext=this.signaturesList[i].x;break}this.signatureCurrent=this.signaturesList[i].x,e=this.signaturesList[i].q}}if(void 0!==e){var s=this.key,n=this.timeSignatureNumerator,r=this.timeSignatureDenominator;this.changeKeySignatureIfNeeded(e),this.changeTimeSignatureIfNeeded(e),this.clearSignatureOverlay(),this.drawSignatures(this.overlayG,0,!0,!0,!0),this.key=s,this.timeSignatureNumerator=n,this.timeSignatureDenominator=r}this.config.pixelsPerTimeStep>0&&0===t&&(this.signatureNext=0,this.signaturesBlinking=!0,a.setFade(this.overlayG,this.signaturesBlinking))},t.prototype.getBarLength=function(){return 4*this.timeSignatureNumerator/this.timeSignatureDenominator},t.prototype.scrollIntoViewIfNeeded=function(t,e){if(t)if(this.scrollType===s.PAGE){var i=this.parentElement.getBoundingClientRect().width;e>this.parentElement.scrollLeft+i&&(this.parentElement.scrollLeft=e-20)}else{i=this.parentElement.getBoundingClientRect().width;this.parentElement.scrollLeft=e-.5*i}},t.prototype.updateVerticalBoundaries=function(t,e){var i=0;if(t<0){this.staffOffset-=t;var s="translate(0, "+this.staffOffset+")";this.overlayG.setAttributeNS(null,"transform",s),this.staffG.setAttributeNS(null,"transform",s),i=this.height-t}if((i=Math.max(i,e-t))>this.height){this.height=i,this.overlaySVG.setAttributeNS(null,"height",""+this.height),this.staffSVG.setAttributeNS(null,"height",""+this.height);for(var n=this.div.querySelectorAll('rect[data-id="background"]'),a=0;a<n.length;++a){var r=n[a];r.setAttributeNS(null,"y",""+-this.staffOffset),r.setAttributeNS(null,"height",""+this.height)}}},t.prototype.setFill=function(t,e){void 0===e&&(e=!1),t.setAttributeNS(null,"fill",this.getColor(e))},t.prototype.setStroke=function(t,e,i){void 0===e&&(e=n.LINE_STROKE),void 0===i&&(i=!1),t.setAttributeNS(null,"stroke",this.getColor(i)),t.setAttributeNS(null,"stroke-width",""+e)},t.prototype.getColor=function(t){return"rgb("+(t?this.config.activeNoteRGB:this.config.noteRGB)+")"},t.prototype.getOpacity=function(t){return t?t/127*.8+.2:1},t.prototype.getGroup=function(t){var e=t.start,i=t.pitch;return this.staffSVG.querySelector('g[data-id="'+e+"-"+i+'"]')},t.prototype.highlightElement=function(t,e){t.setAttribute("fill",this.getColor(e)),t.setAttribute("stroke",this.getColor(e))},t.prototype.getBarBeginnings=function(){var t=new Set,e=0;this.scoreInfo.notes.forEach((function(t){t.start+t.length>e&&(e=t.start+t.length)}));var i=this.scoreInfo.timeSignatures?this.scoreInfo.timeSignatures.slice(0):[{start:0,numerator:4,denominator:4}];i.sort((function(t,e){return t.start-e.start}));for(var s=0,n=0;n<i.length;++n)for(var a=n===i.length-1?e:i[n].start,r=4*i[n].numerator/i[n].denominator;s<a;s+=r)t.add(s);return t},t.prototype.quartersToTime=function(t){return t/this.scoreInfo.tempos[0].qpm*60},t.prototype.timeToQuarters=function(t){return t*this.scoreInfo.tempos[0].qpm/60},t.prototype.setDetails=function(){var t=this,e=new Map,i=this.getBarBeginnings(),s=new Set(i);this.scoreInfo.notes.slice().sort((function(t,e){return t.start-e.start})).forEach((function(i){var n=t.getQNote(i);s.add(n.start),s.add(n.start+n.length),e.has(n.start)?e.get(n.start).push(n):e.set(n.start,[n])})),Array.from(s).sort((function(t,e){return t-e})).forEach((function(i){var s=[];e.forEach((function(e){e.forEach((function(e){var n=t.splitQNote(e,i);n&&s.push(n)}))})),s.forEach((function(t){e.has(t.start)?e.get(t.start).push(t):e.set(t.start,[t])}))})),e=new Map(Array.from(e).sort((function(t,e){return t[0]-e[0]})));var n=this.key,a=null,r=0,h=i[Symbol.iterator](),o=h.next();e.forEach((function(e,i){var s={maxVStep:Number.MAX_SAFE_INTEGER,minVStep:Number.MIN_SAFE_INTEGER,restToNextLength:0,isBarBeginning:!1,notes:[]};t.changeKeySignatureIfNeeded(i);var n=o.value+t.getBarLength();!o.done&&i>=n&&(o=h.next(),t.barAccidentals={},s.isBarBeginning=!0),e.forEach((function(e){t.analyzePitch(e,i),s.minVStep=Math.max(e.vSteps,s.minVStep),s.maxVStep=Math.min(e.vSteps,s.maxVStep),s.notes.push(e)})),a&&(a.restToNextLength=i-r),t.musicBlockMap.set(i,s),a=s,r=i+s.notes[0].length})),this.initialRest={maxVStep:0,minVStep:0,restToNextLength:this.musicBlockMap.values().next().value.notes[0].start,isBarBeginning:!0,notes:[{start:0,length:0,vSteps:0,accidental:0,opacity:0,pitch:0,xHeadRight:0}]},this.key=n},t.prototype.getQNote=function(t){return{start:t.start,length:t.length,vSteps:0,accidental:0,opacity:this.getOpacity(t.intensity),pitch:t.pitch,xHeadRight:0}},t.prototype.splitQNote=function(t,e){var i=t.start+t.length-e;return e>t.start&&i>0?(t.length-=i,{start:e,length:i,vSteps:t.vSteps,accidental:t.accidental,opacity:t.opacity,pitch:t.pitch,xHeadRight:0,tiedFrom:t}):null},t.prototype.analyzePitch=function(t,e){var i=this.getPitchDetails(t.pitch);i.vSteps in this.barAccidentals?i.accidental===this.barAccidentals[i.vSteps]?i.accidental=0:(3===this.barAccidentals[i.vSteps]?i.accidental=i.keyAccidental:0===i.accidental&&(i.accidental=3),this.barAccidentals[i.vSteps]=i.accidental):(t.tiedFrom&&(i.accidental=0),this.barAccidentals[i.vSteps]=i.accidental),t.vSteps=i.vSteps,t.accidental=i.accidental},t.prototype.getPitchDetails=function(t){var e=t-60,i=Math.floor(e/12),s=e-12*i,n=h[this.key].steps[s],a=71===this.clef?6:-6,r=1===o[this.key].accidental?69+(s+3)%12:64+(s+8)%12;return{vSteps:a-7*i+n,accidental:h[this.key].accidental[s],keyAccidental:o[this.key].pitches.indexOf(r)>-1?o[this.key].accidental:0}},t}();e.StaffSVGRender=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_RESOLUTION=.0625,e.STEM_WIDTH=15,e.LINE_STROKE=1,e.COMPACT_SPACING=150},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SVGNS="http://www.w3.org/2000/svg",e.drawSVGPath=function(t,i,s,n,a,r,h){void 0===h&&(h=1);var o=document.createElementNS(e.SVGNS,"path");return o.setAttributeNS(null,"d",i),o.setAttributeNS(null,"transform","translate("+s+", "+n+") scale("+a+", "+r+")"),o.setAttributeNS(null,"opacity",""+h),t.appendChild(o),o},e.drawSVGText=function(t,i,s,n,a,r,h,o){void 0===r&&(r=!1),void 0===h&&(h=1),void 0===o&&(o=1);var l=document.createElementNS(e.SVGNS,"text");l.setAttributeNS(null,"font-family","Times"),l.setAttributeNS(null,"font-size",a),r&&l.setAttributeNS(null,"font-weight","bold"),l.setAttributeNS(null,"transform","translate("+s+", "+n+") scale("+h+", "+o+")");var c=document.createTextNode(i);return l.appendChild(c),t.appendChild(l),l},e.createSVGGroupChild=function(t,i){var s=document.createElementNS(e.SVGNS,"g");return s.setAttribute("data-id",i),t.appendChild(s),s},e.setFade=function(t,i,s,n){void 0===i&&(i=!1),void 0===s&&(s=1),void 0===n&&(n=0);var a=t.querySelector("animate");if(!a){(a=document.createElementNS(e.SVGNS,"animate")).setAttributeNS(null,"attributeName","opacity"),a.setAttributeNS(null,"dur","4s"),a.setAttributeNS(null,"fill","freeze"),a.setAttributeNS(null,"keyTimes","0; 0.25; 0.5; 0.75; 1");var r=(s+3*n)/4;a.setAttributeNS(null,"values",s+"; "+r+"; "+n+"; "+r+"; "+s)}return i?a.setAttributeNS(null,"repeatCount","indefinite"):a.setAttributeNS(null,"repeatCount","1"),t.appendChild(a),t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PATH_SCALE=100;var s="M 0,10 C 0,-15 35,-50 80,-50 110,-50 125,-35 125,-10 \n125,15 90,50 45,50 15,50 0,35 0,10 Z";e.staffLinePath="m 0,0 h 100",e.extraLinePath="m -25,0 h 175",e.barPath="m 0,-200 v 400",e.stemPath="m 0,0 v 100 h 15 v -100 z",e.singleFlagPath="M0,0 h 12 c 7,100 175,156 62,314 79,-177 -49,\n-193 -61,-200 l -13,-5 z",e.multiFlagPath="m 0,0 h 10 c 6,72 173,64 84,227 44,-120 -44,\n-123 -94,-167 z",e.tiePath="M 0,25 C 10,46 30,67 50,67 69,67 90,47 100,25 94,\n65 73,89 50,89 26,89 5,63 0,25 Z",e.dotPath="M 5 -20 a 20 20 0 1 0 0.00001 0 z",e.NOTE_PATHS={4:{path:"m 0,0 c 0,-37 49,-51 79,-51 31,0 83,13 83,51 0,39 \n-55,51 -84,51 C 49,51 0,37 0,0 Z m 111,31 c 13,-19 0,-58 -22,-68 -33,-15 \n-53,10 -39,49 9,27 48,39 61,19 z",width:150,stemVSteps:0,stemAnchor:0,flags:0},2:{path:"m 0,10 c 0,-25 35,-60 80,-60 15,0 45,4 45,40 C 125,16 \n89,50 45,50 17,50 0,36 0,10 Z m 71,7 c 17,-11 45,-34 38,-45 -7,-10 -39,1 \n-57,12 -19,11 -42,31 -36,42 6,10 37,2 55,-9 z",width:125,stemVSteps:7,stemAnchor:-10,flags:0},1:{path:s,width:125,stemVSteps:7,stemAnchor:-10,flags:0},.5:{path:s,width:125,stemVSteps:7,stemAnchor:-10,flags:1},.25:{path:s,width:125,stemVSteps:9,stemAnchor:-10,flags:2},.125:{path:s,width:125,stemVSteps:11,stemAnchor:-10,flags:3},.0625:{path:s,width:125,stemVSteps:13,stemAnchor:-10,flags:4}},e.REST_PATHS={4:"m 0,-50 h 125 v -50 H 0 Z",2:"M 0,0 H 125 V -50 H 0 Z",1:"m 0,-25 c 39,-39 37,-75 8,-120 l 6,-5 61,103 C \n40,-13 31,4 73,71 l -5,5 C 14,52 16,125 67,144 l -4,6 C -37,102 -1,22 59,60 Z",.5:"m 52,-47 c 26,-2 42,-21 48,-42 l 12,4 L 64,83 52,79 \n88,-49 c 0,0 -17,22 -57,22 -16,0 -31,-13 -31,-27 0,-18 10,-31 27,-31 17,0 \n33,15 25,38 z",.25:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 l -36,128 12,4 77,-270 z",.125:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 L 68,20 C 61,37 46,51 24,52 32,29 16,14 -1,14 c \n-17,0 -27,13 -27,31 0,14 15,27 31,27 38,0 55,-20 57,-22 l -36,128 12,4 \n105,-369 z",.0625:"m 158,-292 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -17,61 \nv 0 c -6,21 -22,40 -48,42 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 \n15,27 31,27 40,0 57,-22 57,-22 l -20,69 c -7,18 -22,33 -45,35 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 L 68,20 C \n61,37 46,51 24,52 32,29 16,14 -1,14 c -17,0 -27,13 -27,31 0,14 15,27 31,27 \n38,0 55,-20 57,-22 l -36,128 12,4 134,-469 z"},e.CLEF_PATHS={50:{path:"m 101,-199 c -49,0 -100,28 -100,83 0,39 58,57 82,26 15,-20 \n-4,-47 -32,-47 -23,1 -25,0 -25,-8 0,-22 40,-46 71,-41 91,16 67,208 -105,302 \n75,-27 198,-94 211,-201 6,-66 -42,-114 -102,-114 z m 143,33 c -13,0 -23,11 \n-23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 z m 2,83 c \n-13,0 -23,11 -23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 \nz",upper:-4,lower:3},71:{path:"M 139,48 C 102,57 76,120 131,151 41,128 64,24 129,2 L \n117,-57 C -32,47 26,217 166,182 Z m 12,-1 27,131 C 242,153 216,46 151,47 \nZ m -35,-177 c 34,-23 82,-117 50,-140 -23,-17 -71,33 -50,140 z m -10,10 c \n-23,-77 -20,-200 48,-213 19,-4 89,171 -26,266 l 13,66 c 120,-6 137,155 \n39,191 l 12,58 c 30,131 -137,145 -138,47 0,-29 37,-59 63,-37 21,18 25,71 \n-25,70 32,42 103,0 91,-65 L 167,193 C 56,232 -112,63 106,-120 Z",upper:-7,lower:8}},e.ACCIDENTAL_PATHS=[null,"m -49,-121 v 52 l -29,9 v -48 h -8 v 51 l -20,6 v 29 l \n20,-6 v 70 l -20,6 v 30 l 20,-6 v 51 h 8 V 69 l 30,-8 v 50 h 8 V 58 l 20,-6 \nV 23 l -20,6 v -71 l 20,-6 v -29 l -20,6 v -50 z m 1,82 v 71 l -29,9 v -71 z","M -106,-166 V 67 c 52,-42 85,-56 85,-94 0,-47 -46,-51 \n-73,-22 v -117 z m 31,120 c 20,0 42,46 -20,91 V -7 c 0,-28 10,-39 20,-39 z","m -81,-58 v -48 H -92 V 73 l 60,-13 v 50 h 11 V -72 Z m \n50,24 v 58 l -50,11 v -58 z"]}]);