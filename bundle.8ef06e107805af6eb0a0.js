(()=>{var e,t={761:(e,t,n)=>{"use strict";var r=n(9477),i=n(9365),a=n(5079),o=n(4327),s=n(2524);let c,l,d,u,m,p,h,v,f,_,w,g,y,b,x;!1===o.Z.isWebGL2Available()&&document.body.appendChild(o.Z.getWebGL2ErrorMessage());let A,P,E,M,T,F={};Object.defineProperty(F,"__esModule",{value:!0}),F.AudioReader=class{constructor(e){if("Float32Array"!=e.type())throw"This class requires a ring buffer of Float32Array";this.ringbuf=e}dequeue(e){return this.ringbuf.empty()?0:this.ringbuf.pop(e)}available_read(){return this.ringbuf.available_read()}},F.AudioWriter=class{constructor(e){if("Float32Array"!=e.type())throw"This class requires a ring buffer of Float32Array";this.ringbuf=e}enqueue(e){return this.ringbuf.push(e)}available_write(){return this.ringbuf.available_write()}},F.ParameterReader=class{constructor(e){this.ringbuf=e,this.mem=new ArrayBuffer(5),this.array=new Uint8Array(this.mem),this.view=new DataView(this.mem)}dequeue_change(e){return!this.ringbuf.empty()&&(this.ringbuf.pop(this.array),e.index=this.view.getUint8(0),e.value=this.view.getFloat32(1),!0)}},F.ParameterWriter=class{constructor(e){if("Uint8Array"!=e.type())throw"This class requires a ring buffer of Uint8Array";this.ringbuf=e,this.mem=new ArrayBuffer(5),this.array=new Uint8Array(this.mem),this.view=new DataView(this.mem)}enqueue_change(e,t){return this.view.setUint8(0,e),this.view.setFloat32(1,t),!(this.ringbuf.available_write()<5)&&5==this.ringbuf.push(this.array)}},F.RingBuffer=class{static getStorageForCapacity(e,t){if(!t.BYTES_PER_ELEMENT)throw"Pass in a ArrayBuffer subclass";var n=8+(e+1)*t.BYTES_PER_ELEMENT;return new SharedArrayBuffer(n)}constructor(e,t){if(!ArrayBuffer.__proto__.isPrototypeOf(t)&&void 0!==t.BYTES_PER_ELEMENT)throw"Pass a concrete typed array class as second argument";this._type=t,this.capacity=(e.byteLength-8)/t.BYTES_PER_ELEMENT,this.buf=e,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new t(this.buf,8,this.capacity)}type(){return this._type.name}push(e){var t=Atomics.load(this.read_ptr,0),n=Atomics.load(this.write_ptr,0);if((n+1)%this._storage_capacity()==t)return 0;let r=Math.min(this._available_write(t,n),e.length),i=Math.min(this._storage_capacity()-n,r),a=r-i;return this._copy(e,0,this.storage,n,i),this._copy(e,i,this.storage,0,a),Atomics.store(this.write_ptr,0,(n+r)%this._storage_capacity()),r}pop(e){var t=Atomics.load(this.read_ptr,0),n=Atomics.load(this.write_ptr,0);if(n==t)return 0;let r=Math.min(this._available_read(t,n),e.length),i=Math.min(this._storage_capacity()-t,e.length),a=r-i;return this._copy(this.storage,t,e,0,i),this._copy(this.storage,0,e,i,a),Atomics.store(this.read_ptr,0,(t+r)%this._storage_capacity()),r}empty(){var e=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)==e}full(){var e=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this.capacity!=e}capacity(){return this.capacity-1}available_read(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}available_write(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}_available_read(e,t){return t>e?t-e:t+this._storage_capacity()-e}_available_write(e,t){let n=e-t-1;return t>=e&&(n+=this._storage_capacity()),n}_storage_capacity(){return this.capacity}_copy(e,t,n,r,i){for(var a=0;a<i;a++)n[r+a]=e[t+a]}},F.deinterleave=function(e,t){var n=e.length/256;if(t.length!=n)throw"not enough space in output arrays";for(var r=0;r<channelCount;r++){let a=t[r],o=r;for(var i=0;i<128;++i)a[i]=e[o],o+=n}},F.interleave=function(e,t){if(128*e.length!=t.length)throw"input and output of incompatible sizes";for(var n=0,r=0;r<128;r++)for(;j<t.length;j++)t[n]=e[0][r],n++};try{b=window.AudioContext||window.webkitAudioContext,x=new b}catch(e){throw"Could not instantiate AudioContext: "+e.message}let S=navigator;void 0===S.mediaDevices&&(S.mediaDevices={});const k=document.getElementById("loadFileInput"),O=document.getElementById("recordButton");function B(){c.aspect=window.innerWidth/window.innerHeight,c.updateProjectionMatrix(),d.setSize(window.innerWidth,window.innerHeight),C()}function U(e){_.x=e.clientX/window.innerWidth*2-1,_.y=-e.clientY/window.innerHeight*2+1}function z(e,t,n){const i=new Uint8Array(e*t*n*4);let a=0;for(let r=0;r<n;r++)for(let o=0;o<t;o++)for(let s=0;s<e;s++)i[a+0]=s/e*255,i[a+1]=o/t*255,i[a+2]=r/n*255,i[a+3]=255,a+=4;const o=new r.JUT(i,e,t,n);return o.format=r.wk1,o.unpackAlignment=1,o.needsUpdate=!0,o}function L(e,t){const n=new Float32Array(e*t*4);let i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++)n[i+0]=1,n[i+1]=0,n[i+2]=0,n[i+3]=1,i+=4;const a=new r.IEO(n,e,t);return a.format=r.wk1,a.type=r.VzW,a.minFilter=r.TyD,a.magFilter=r.TyD,a.unpackAlignment=1,a.needsUpdate=!0,a}function D(e){const t=new Float32Array(4*e.numPoints*4);let n=0;const i=[e.positions,e.tangents,e.normals,e.binormals];for(let r=0;r<4;r++)for(let a=0;a<e.numPoints;a++)t[n+0]=i[r][a].x,t[n+1]=i[r][a].y,t[n+2]=i[r][a].z,t[n+3]=1,n+=4;const a=new r.IEO(t,e.numPoints,1);return a.type=r.VzW,a.format=r.wk1,a.minFilter=r.TyD,a.magFilter=r.TyD,a.unpackAlignment=1,a.needsUpdate=!0,a}function C(){d.render(l,c)}let R;addEventListener("change",(()=>{return e=k,(0,s.lj)(e.files[0]).then((e=>async function(e){const t=await(0,s.qn)(e);return(0,s.ZP)((0,s.k5)(t,{sampleRate:16e3,hopLength:512,nMels:229,nFft:2048,fMin:30}))}(e))).then((e=>function(e,t,n){const i=new Float32Array(t*n*4);let a=0;for(let r=0;r<n;r++)for(let n=0;n<t;n++)i[a+0]=e[n][r],i[a+1]=0,i[a+2]=0,i[a+3]=0,a+=4;for(var o=-1/0,s=1/0,c=0;c<i.length;c++)i[c]>o&&(o=i[c]);for(c=0;c<i.length;c++)i[c]<s&&(s=i[c]);for(a=0;a<t*n*4;)i[a]=(i[a]-s)/(o-s),a+=4;const l=new r.IEO(i,t,n);return l.format=r.wk1,l.type=r.VzW,l.minFilter=r.TyD,l.magFilter=r.TyD,l.unpackAlignment=1,l.needsUpdate=!0,l}(e,e.length,229))).then((e=>{return t=e,v.material.map=t,v.material.dispose(),f.material.uniforms.spectrum.value=t,void f.material.dispose();var t}));var e})),function(){l=new r.xsS,d=new r.CP7({antialias:!0}),d.setPixelRatio(window.devicePixelRatio),d.setSize(window.innerWidth,window.innerHeight);const e=window.innerWidth/window.innerHeight;c=new r.cPb(45,e,.01,1e3),c.position.set(0,0,10),l.add(c),u=new i.z(c,d.domElement),u.addEventListener("change",C),u.minZoom=.1,u.maxZoom=10,u.enablePan=!1,u.update();let t=new r._12(2,2),n=new r.vBJ({map:L(4,4),side:r.ehD});v=new r.Kj0(t,n),v.position.set(-2,0,-1),l.add(v);const o=new r.DvJ(1,1,1);w=new r.SUY;const s=function(e){const t=new r.YT8([new r.Pa4(0,0,-.5),new r.Pa4(0,0,-.25),new r.Pa4(0,0,0),new r.Pa4(0,0,.25),new r.Pa4(0,0,.5)]),n=t.getSpacedPoints(5),i=t.computeFrenetFrames(5,!0);return y={positions:n,tangents:i.tangents,normals:i.normals,binormals:i.binormals,numPoints:5},t}().getPoints(5),b=(new r.u9r).setFromPoints(s),x=new r.nls({color:16711680});g=new r.x12(b,x),g.matrixAutoUpdate=!1,l.add(g);const A={volume_scale:{value:new r.Pa4(1,1,1)},volume:{value:z(4,4,4)},volume_dims:{value:new r.Pa4(4,4,4)},aabb_min:{value:new r.Pa4},aabb_max:{value:new r.Pa4},dt_scale:{value:.1},spectrum:{value:L(100,1024)},curve_data:{value:D(y)},time:{value:w.getElapsedTime()}},P=new r.jyz({uniforms:A,vertexShader:"\nuniform vec3 volume_scale;\nout vec3 vray_dir;\nflat out vec3 transformed_eye;\nvoid main(void) {\n // TODO: For non-uniform size volumes we need to transform them differently as well\n // to center them properly\n vec3 volume_translation = vec3(0.5) - volume_scale * 0.5;\n gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1);\n transformed_eye = (cameraPosition - volume_translation) / volume_scale;\n vray_dir = position - transformed_eye;\n}",fragmentShader:"\nprecision highp int;\nprecision highp float;\nuniform highp sampler3D volume;\nuniform highp sampler2D spectrum;\nuniform highp sampler2D curve_data;\nuniform ivec3 volume_dims;\nuniform vec3 volume_scale;\nuniform float dt_scale;\nuniform vec3 aabb_min;\nuniform vec3 aabb_max;\nuniform float time;\nin vec3 vray_dir;\nflat in vec3 transformed_eye;\n \nvec2 intersect_box(vec3 aabbMin, vec3 aabbMax, vec3 orig, vec3 dir) {\n \n vec3 inv_dir = 1.0 / dir;\n vec3 tmin_tmp = (aabbMin - orig) * inv_dir;\n vec3 tmax_tmp = (aabbMax - orig) * inv_dir;\n vec3 tmin = min(tmin_tmp, tmax_tmp);\n vec3 tmax = max(tmin_tmp, tmax_tmp);\n float t0 = max(tmin.x, max(tmin.y, tmin.z));\n float t1 = min(tmax.x, min(tmax.y, tmax.z));\n return vec2(t0, t1);\n}\n// Pseudo-random number gen from\n// http://www.reedbeta.com/blog/quick-and-easy-gpu-random-numbers-in-d3d11/\n// with some tweaks for the range of values\nfloat wang_hash(int seed) {\n seed = (seed ^ 61) ^ (seed >> 16);\n seed *= 9;\n seed = seed ^ (seed >> 4);\n seed *= 0x27d4eb2d;\n seed = seed ^ (seed >> 15);\n return float(seed % 2147483647) / float(2147483647);\n}\nfloat linear_to_srgb(float x) {\n if (x <= 0.0031308f) {\n   return 12.92f * x;\n }\n return 1.055f * pow(x, 1.f / 2.4f) - 0.055f;\n}\nvec4 color_transfer(float intensity)\n{\n vec3 high = vec3(0.0, 0.0, 0.0);\n vec3 low = vec3(1.0, 1.0, 1.0);\n float alpha = (exp(intensity) - 1.0) / (exp(1.0) - 1.0);\n return vec4(intensity * high + (1.0 - intensity) * low, alpha);\n}\n \nfloat sdSphere( vec3 p, vec3 offset, float scale )\n{\n float dist = length(p - offset) - scale;\n return 1.0 - clamp(dist, 0.0, 1.0);\n}\nfloat distCurve(vec3 p){\n float min_dist = 10.0;\n float du = 0.2;\n float u = 0.0;\n while(u < 1.0 ){\n   vec2 v_pos = vec2(u, 0.0);\n   // point normals are stored in the 3rd row of the texture\n   // whose UV.v coordinate is 0.75\n   vec2 v_norm = vec2(u, 0.75);\n   vec3 dir_vec = p - texture(curve_data, v_pos).rgb ;\n \n   min_dist = min(min_dist, length(dir_vec));\n   u += du;\n }\n \n return min_dist;\n}\n \nvoid main(void) {\n vec3 ray_dir = normalize(vray_dir);\n vec4 color = vec4(0.0);\n vec2 t_hit = intersect_box(aabb_min, aabb_max, transformed_eye, ray_dir);\n if (t_hit.x > t_hit.y) {\n   discard;\n }\n t_hit.x = max(t_hit.x, 0.0);\n vec3 dt_vec = 1.0 / (vec3(volume_dims) * abs(ray_dir));\n float dt = dt_scale * min(dt_vec.x, min(dt_vec.y, dt_vec.z));\n vec3 p = transformed_eye + (t_hit.x + dt) * ray_dir;\n int step = 0;\n int maxStep = 100 ;\n for (float t = t_hit.x; t < t_hit.y; t += dt) {\n   if (step > maxStep){\n     break;\n   }\n   // use distance function\n   // infinite tube\n   float dist = length(p.xy) - 0.01;\n   // sphere\n   // float dist = clamp(length(p), 0.0, 1.0);\n   // curve\n   // float dist = distCurve(p) * 1.0;\n   // sample spectrogram\n   vec4 spec_val = texture(spectrum, vec2(0.5,  0.03 / dist));\n   vec4 val_color = vec4(pow(spec_val.r,10.0) ,pow(spec_val.r, 2.0),0.0 * pow(spec_val.r,0.0),spec_val.r);\n   //vec4 val_color = vec4(pow(dist,8.0),dist,dist,dist);\n   // Opacity correction\n   val_color.w = 1.0 - pow(1.0 - val_color.w, dt_scale);\n \n   // Alpha-blending\n   color.xyz += (1.0 - color.w) * val_color.w * val_color.xyz;\n   color.w += (1.0 - color.w) * val_color.w;\n   // if (color.w > 0.99) {\n   //   break;\n   // }\n   if (val_color.w < 0.0) {\n     discard;\n   }\n   p += ray_dir * dt;\n   step++;\n }\n color.x = linear_to_srgb(color.x);\n color.y = linear_to_srgb(color.y);\n color.z = linear_to_srgb(color.z);\n gl_FragColor = color;\n //gl_FragColor = vec4(texture(spectrum,vec2(0.0,0.0)).rgb * 255.0, 1.0);\n \n}\n",side:r.ehD,transparent:!0});f=new r.Kj0(o,P),f.matrixAutoUpdate=!0,f.geometry.computeBoundingBox(),f.material.uniforms.aabb_min.value=f.geometry.boundingBox.min,f.material.uniforms.aabb_max.value=f.geometry.boundingBox.max,l.add(f),_=new r.FM8,window.addEventListener("pointerMove",U);const E=new r._12(25,25),M=new r.vBJ({visible:!1});h=new r.Kj0(E,M),h.rotation.x=-.5*Math.PI,l.add(h),h.name="plane",p=new r.iMs,function(e){const t=new r.VLJ(10,10);e.add(t),m=(0,a.Z)(),document.body.appendChild(m.dom);const n=new r.y8_(3);e.add(n)}(l),C(),document.addEventListener("pointermove",U),window.addEventListener("resize",B),O.addEventListener("click",Y)}(),function e(){requestAnimationFrame(e),f.material.uniforms.time.value=w.getElapsedTime(),f.material.uniforms.curve_data.value=function(e,t){const n=e.geometry.attributes.position.array,i=Array(5);let a=0;for(let e=0;e<5;e++)i[e]=4==e?new r.Pa4(n[a+0],n[a+1]+Math.abs(Math.sin(w.getElapsedTime())),n[a+2]):new r.Pa4(n[a+0],n[a+1],n[a+2]),a+=3;const o=new r.YT8(i),s=o.getSpacedPoints(5),c=o.computeFrenetFrames(5,!0);return y={positions:s,tangents:c.tangents,normals:c.normals,binormals:c.binormals,numPoints:5},D(y)}(g),m.update(),C()}();const W=[];let q,V,I;function Y(){O.classList.contains("recording")?(R&&(cancelAnimationFrame(R),drawFullSpectrogram()),A.getAudioTracks().forEach((function(e){e.stop(),A.removeTrack(e)})),x.close().then((function(){O.classList.rwmove("recording"),O.innerHTML="Mic",P.disconnect(),M.disconnect(),E.disconnect(),P=void 0,M=void 0,E=void 0,console.log("Stopped recording ...")}))):(O.setAttribute("disabled",!0),function(){if(!navigator.mediaDevices.getUserMedia)throw"Could not access microphone - getUserMedia not available";console.log("Initializing audio..."),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(H).catch((function(e){throw"Could not access microphone - "+e}))}())}function H(e){if(A=e,!A.active)throw"Mic stream not active";"closed"==x.state?x=new b:"suspended"==x.state&&x.resume(),P=x.createMediaStreamSource(A),E=x.createGain(),E.gain.setValueAtTime(0,x.currentTime),function(e){const t=["https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia-wasm.umd.js","https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia.js-extractor.umd.js","https://raw.githack.com/MTG/essentia.js/master/examples/demos/melspectrogram-rt/melspectrogram-processor.js","https://unpkg.com/ringbuf.js@0.1.0/dist/index.js"].map((e=>fetch(e).then((e=>e.text()))));return Promise.all(t).then((e=>{e.unshift("var exports = {};");const t=e.join(""),n=new Blob([t],{type:"text/javascript"});return URL.createObjectURL(n)}))}().then((e=>{x.audioWorklet.addModule(e).then(N).catch((function(e){console.log(`There was a problem loading the AudioWorklet module code: \n ${e}`)}))})).catch((e=>{console.log(`There was a problem retrieving the AudioWorklet module code: \n ${e}`)})),O.classList.add("recording"),O.innerHTML="STOP",O.setAttribute("disabled",!1)}function N(){let e=F.RingBuffer.getStorageForCapacity(1728,Float32Array),t=new F.RingBuffer(e,Float32Array);T=new F.AudioReader(t),M=new AudioWorkletNode(x,"melspectrogram-processor",{processorOptions:{bufferSize:1024,hopSize:512,melNumBands:96,sampleRate:x.sampleRate}});try{M.port.postMessage({sab:e})}catch(e){return alert("No SharedArrayBuffer transfer support, try another browser."),void O.setAttribute("disabled",!0)}P.connect(M),M.connect(E),E.connect(x.destination),requestAnimationFrame(Z)}function Z(e){void 0===V&&(V=e),I=e-V,R=requestAnimationFrame(Z);let t=new Float32Array(96);T.available_read()>=96&&0!==T.dequeue(t)&&(q=t.map((e=>Math.round(35.5*e))),W.push(q),console.log(q.length))}},6470:()=>{},5751:()=>{},4673:()=>{},3522:()=>{},7159:()=>{},2664:()=>{},2967:()=>{}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}r.m=t,r.amdD=function(){throw new Error("define cannot be used indirect")},r.amdO={},e=[],r.O=(t,n,i,a)=>{if(!n){var o=1/0;for(d=0;d<e.length;d++){for(var[n,i,a]=e[d],s=!0,c=0;c<n.length;c++)(!1&a||o>=a)&&Object.keys(r.O).every((e=>r.O[e](n[c])))?n.splice(c--,1):(s=!1,a<o&&(o=a));if(s){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,i,a]},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={947:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var i,a,[o,s,c]=n,l=0;if(o.some((t=>0!==e[t]))){for(i in s)r.o(s,i)&&(r.m[i]=s[i]);if(c)var d=c(r)}for(t&&t(n);l<o.length;l++)a=o[l],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(d)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=r.O(void 0,[365,53,124],(()=>r(761)));i=r.O(i)})();
//# sourceMappingURL=bundle.8ef06e107805af6eb0a0.js.map