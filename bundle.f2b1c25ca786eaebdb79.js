(()=>{"use strict";var e,n={490:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.AudioReader=class{constructor(e){if("Float32Array"!=e.type())throw"This class requires a ring buffer of Float32Array";this.ringbuf=e}dequeue(e){return this.ringbuf.empty()?0:this.ringbuf.pop(e)}available_read(){return this.ringbuf.available_read()}},n.AudioWriter=class{constructor(e){if("Float32Array"!=e.type())throw"This class requires a ring buffer of Float32Array";this.ringbuf=e}enqueue(e){return this.ringbuf.push(e)}available_write(){return this.ringbuf.available_write()}},n.ParameterReader=class{constructor(e){this.ringbuf=e,this.mem=new ArrayBuffer(5),this.array=new Uint8Array(this.mem),this.view=new DataView(this.mem)}dequeue_change(e){return!this.ringbuf.empty()&&(this.ringbuf.pop(this.array),e.index=this.view.getUint8(0),e.value=this.view.getFloat32(1),!0)}},n.ParameterWriter=class{constructor(e){if("Uint8Array"!=e.type())throw"This class requires a ring buffer of Uint8Array";this.ringbuf=e,this.mem=new ArrayBuffer(5),this.array=new Uint8Array(this.mem),this.view=new DataView(this.mem)}enqueue_change(e,n){return this.view.setUint8(0,e),this.view.setFloat32(1,n),!(this.ringbuf.available_write()<5)&&5==this.ringbuf.push(this.array)}},n.RingBuffer=class{static getStorageForCapacity(e,n){if(!n.BYTES_PER_ELEMENT)throw"Pass in a ArrayBuffer subclass";var t=8+(e+1)*n.BYTES_PER_ELEMENT;return new SharedArrayBuffer(t)}constructor(e,n){if(!ArrayBuffer.__proto__.isPrototypeOf(n)&&void 0!==n.BYTES_PER_ELEMENT)throw"Pass a concrete typed array class as second argument";this._type=n,this.capacity=(e.byteLength-8)/n.BYTES_PER_ELEMENT,this.buf=e,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new n(this.buf,8,this.capacity)}type(){return this._type.name}push(e){var n=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);if((t+1)%this._storage_capacity()==n)return 0;let a=Math.min(this._available_write(n,t),e.length),o=Math.min(this._storage_capacity()-t,a),r=a-o;return this._copy(e,0,this.storage,t,o),this._copy(e,o,this.storage,0,r),Atomics.store(this.write_ptr,0,(t+a)%this._storage_capacity()),a}pop(e){var n=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);if(t==n)return 0;let a=Math.min(this._available_read(n,t),e.length),o=Math.min(this._storage_capacity()-n,e.length),r=a-o;return this._copy(this.storage,n,e,0,o),this._copy(this.storage,0,e,o,r),Atomics.store(this.read_ptr,0,(n+a)%this._storage_capacity()),a}empty(){var e=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)==e}full(){var e=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this.capacity!=e}capacity(){return this.capacity-1}available_read(){var e=Atomics.load(this.read_ptr,0),n=Atomics.load(this.write_ptr,0);return this._available_read(e,n)}available_write(){var e=Atomics.load(this.read_ptr,0),n=Atomics.load(this.write_ptr,0);return this._available_write(e,n)}_available_read(e,n){return n>e?n-e:n+this._storage_capacity()-e}_available_write(e,n){let t=e-n-1;return n>=e&&(t+=this._storage_capacity()),t}_storage_capacity(){return this.capacity}_copy(e,n,t,a,o){for(var r=0;r<o;r++)t[a+r]=e[n+r]}},n.deinterleave=function(e,n){var t=e.length/256;if(n.length!=t)throw"not enough space in output arrays";for(var a=0;a<channelCount;a++){let r=n[a],i=a;for(var o=0;o<128;++o)r[o]=e[i],i+=t}},n.interleave=function(e,n){if(128*e.length!=n.length)throw"input and output of incompatible sizes";for(var t=0,a=0;a<128;a++)for(;j<n.length;j++)n[t]=e[0][a],t++}},301:(e,n,t)=>{var a=t(477),o=t(365),r=(t(79),t(13));const i={"audio-1":t.p+"3e3ec63d65dbac197668.mp3","audio-2":t.p+"af94b875b527644acadf.mp3","audio-3":t.p+"7b5db9c538fd2fd44406.mp3"};let s,l,c,d,_,u,m,p,f,v,h,g,b,x,y,w=96,z=1,A={};A=t(490);let C,P=[];const k=new r.GUI({width:200}),E={df_type:0,dist_func_tube:1,dist_func_box:1,dist_func_plane:1,df_sphere_tube:0,df_sphere_box:0,df_sphere_plane:0,df_tube_box:0,df_tube_plane:0,df_plane_box:0,scale_x:1,scale_y:1,scale_z:1,global_scale:.03,min_dist:0,max_dist:1,rot_x:0,rot_y:0,rot_z:0,translation_x:0,translation_y:0,translation_z:0,playback_rate:1,color_mode:0,color_preset_type:0,color_space:0,uni_color:"#9838ff",color_1:"#000000",color_2:"#ffffff",mel_spec_bins:w,num_frames:z,fft_size:1024,dt_scale:.1,max_steps:100};function F(e){const n=e.map((e=>fetch(e).then((e=>e.text()))));return Promise.all(n).then((e=>{e.unshift("var exports = {};");const n=e.join(""),t=new Blob([n],{type:"text/javascript"});return URL.createObjectURL(t)}))}try{x=window.AudioContext||window.webkitAudioContext,y=new x}catch(e){throw"Could not instantiate AudioContext: "+e.message}let T,M,j,B,S,R,U=navigator;void 0===U.mediaDevices&&(U.mediaDevices={});const L=document.getElementById("loadFileInput"),q=document.getElementById("recordButton"),O=document.getElementById("audioPlayer");O.src=i["audio-1"],O.load();const I=window.URL||window.webkitURL,W=document.getElementById("button-group");function D(){c.render(l,s)}function N(){s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight),D()}function K(e){f.x=e.clientX/window.innerWidth*2-1,f.y=-e.clientY/window.innerHeight*2+1}function V(e,n,t){const o=new Uint8Array(e*n*t*4);let r=0;for(let a=0;a<t;a++)for(let i=0;i<n;i++)for(let s=0;s<e;s++)o[r+0]=s/e*255,o[r+1]=i/n*255,o[r+2]=a/t*255,o[r+3]=255,r+=4;const i=new a.JUT(o,e,n,t);return i.format=a.wk1,i.unpackAlignment=1,i.needsUpdate=!0,i}function H(e,n){const t=new Uint8Array(e*n*4);let o=0;for(let a=0;a<n;a++)for(let n=0;n<e;n++)t[o+0]=1,t[o+1]=0,t[o+2]=0,t[o+3]=1,o+=4;const r=new a.IEO(t,e,n);return r.format=a.hEm,r.unpackAlignment=1,r}function Y(e){const n=new Float32Array(4*e.numPoints*4);let t=0;const o=[e.positions,e.tangents,e.normals,e.binormals];for(let a=0;a<4;a++)for(let r=0;r<e.numPoints;r++)n[t+0]=o[a][r].x,n[t+1]=o[a][r].y,n[t+2]=o[a][r].z,n[t+3]=1,t+=4;const r=new a.IEO(n,e.numPoints,1);return r.type=a.VzW,r.format=a.wk1,r.minFilter=a.TyD,r.magFilter=a.TyD,r.unpackAlignment=1,r.needsUpdate=!0,r}function G(){C=q.classList.contains("recording"),C?(q.classList.remove("recording"),q.innerHTML="Record",q.classList.remove("bg-emerald-200"),q.disabled=!1,T.getAudioTracks().forEach((function(e){e.stop(),T.removeTrack(e)})),y.close().then((function(){q.classList.remove("recording"),q.innerHTML="Record",j.disconnect(),S.disconnect(),B.disconnect(),j=void 0,S=void 0,B=void 0,console.log("Stopped recording ...")}))):(q.disabled=!0,function(){if(!navigator.mediaDevices.getUserMedia)throw"Could not access microphone - getUserMedia not available";console.log("Initializing audio..."),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(J).catch((function(e){throw"Could not access microphone - "+e}))}())}function J(e){if(T=e,!T.active)throw"Mic stream not active";"closed"==y.state?y=new x:"suspended"==y.state&&y.resume(),j=y.createMediaStreamSource(T),B=y.createGain(),B.gain.setValueAtTime(0,y.currentTime),F(["https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia-wasm.umd.js","https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia.js-extractor.umd.js","https://raw.githack.com/MTG/essentia.js/master/examples/demos/melspectrogram-rt/melspectrogram-processor.js","https://unpkg.com/ringbuf.js@0.1.0/dist/index.js"]).then((e=>{y.audioWorklet.addModule(e).then(X).catch((function(e){console.log(`There was a problem loading the AudioWorklet module code: \n ${e}`)}))})).catch((e=>{console.log(`There was a problem retrieving the AudioWorklet module code: \n ${e}`)})),q.classList.add("recording"),q.innerHTML="Stop",q.classList.add("bg-emerald-200"),q.disabled=!1}function $(){"closed"==y.state?y=new x:"suspended"==y.state&&y.resume(),M=y.createMediaElementSource(O),B=y.createGain(),B.gain.setValueAtTime(0,y.currentTime),F(["https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia-wasm.umd.js","https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia.js-extractor.umd.js","https://raw.githack.com/MTG/essentia.js/master/examples/demos/melspectrogram-rt/melspectrogram-processor.js","https://unpkg.com/ringbuf.js@0.1.0/dist/index.js"]).then((e=>{y.audioWorklet.addModule(e).then(Q).catch((function(e){console.log(`There was a problem loading the AudioWorklet module code: \n ${e}`)}))})).catch((e=>{console.log(`There was a problem retrieving the AudioWorklet module code: \n ${e}`)}))}function Z(){O.pause(),y.close().then((function(){M.disconnect(),S.disconnect(),M=void 0,S=void 0}))}function X(){let e=A.RingBuffer.getStorageForCapacity(42*w,Float32Array),n=new A.RingBuffer(e,Float32Array);R=new A.AudioReader(n),S=new AudioWorkletNode(y,"melspectrogram-processor",{processorOptions:{bufferSize:1024,hopSize:512,melNumBands:w,sampleRate:y.sampleRate}});try{S.port.postMessage({sab:e})}catch(e){return alert("No SharedArrayBuffer transfer support, try another browser."),void(q.disabled=!0)}C=q.classList.contains("recording"),j.connect(S),S.connect(B),B.connect(y.destination)}function Q(){let e=A.RingBuffer.getStorageForCapacity(18*w,Float32Array),n=new A.RingBuffer(e,Float32Array);R=new A.AudioReader(n),S=new AudioWorkletNode(y,"melspectrogram-processor",{processorOptions:{bufferSize:1024,hopSize:512,melNumBands:w,sampleRate:y.sampleRate}});try{S.port.postMessage({sab:e})}catch(e){return void alert("No SharedArrayBuffer transfer support, try another browser.")}M.connect(y.destination),M.connect(S),S.connect(B),B.connect(y.destination)}function ee(){let e=new Float32Array(w);void 0!==R&&R.available_read()>=w&&0!==R.dequeue(e)&&(P=e.map((e=>Math.round(35.5*e)))),function(e,n){const t=z,o=w,r=e.image.data;let i=0;for(let e=0;e<o;e++)for(let a=0;a<t;a++)r[i]=a<t-1?r[i+4]:n[e],r[i+1]=0,r[i+2]=0,r[i+3]=1,i+=4;const s=new a.IEO(r,t,o);s.format=a.wk1,s.unpackAlignment=1,s.needsUpdate=!0,function(e){m.material.map=e,p.material.uniforms.spectrum.value=e,e.dispose()}(s),s.dispose()}(v,P)}!function(){l=new a.xsS,c=new a.CP7({antialias:!0}),c.setPixelRatio(window.devicePixelRatio),c.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(c.domElement);const e=window.innerWidth/window.innerHeight;s=new a.cPb(45,e,.01,1e3),s.position.set(-2,1,2),l.add(s),d=new o.z(s,c.domElement),d.addEventListener("change",D),d.minZoom=.1,d.maxZoom=10,d.enablePan=!1,d.update(),function(){k.add(E,"playback_rate").step(.001).name("playback_rate").onChange((function(e){p.material.uniforms.playback_rate.value=1/e,O.playbackRate=e})),k.add(E,"num_frames").step(1).name("num_frames").onChange((function(e){v=H(e,w),ee(),z=e}));const e=k.addFolder("distance function");e.add(E,"min_dist").step(.01).name("min_dist").onChange((function(e){p.material.uniforms.min_dist.value=e})),e.add(E,"max_dist").step(.01).name("max_dist").onChange((function(e){p.material.uniforms.max_dist.value=e})),e.add(E,"df_type",{"Sphere - Tube":0,"Sphere - Box":1,"Sphere - Plane":2,"Tube - Box":3,"Tube - Plane":4,"Plane - Box":5}).name("sphere/tube").onChange((function(e){p.material.uniforms.df_type.value=e})),e.add(E,"df_sphere_tube",0,1).step(.01).name("sphere/tube").onChange((function(e){p.material.uniforms.df_sphere_tube.value=e})),e.add(E,"df_sphere_box",0,1).step(.01).name("sphere/box").onChange((function(e){p.material.uniforms.df_sphere_box.value=e})),e.add(E,"df_sphere_plane",0,1).step(.01).name("sphere/plane").onChange((function(e){p.material.uniforms.df_sphere_plane.value=e})),e.add(E,"df_tube_box",0,1).step(.01).name("tube/box").onChange((function(e){p.material.uniforms.df_tube_box.value=e})),e.add(E,"df_tube_plane",0,1).step(.01).name("tube/plane").onChange((function(e){p.material.uniforms.df_tube_plane.value=e})),e.add(E,"df_plane_box",0,1).step(.01).name("plane/box").onChange((function(e){p.material.uniforms.df_plane_box.value=e})),e.add(E,"global_scale").step(1e-4).name("global_scale").onChange((function(e){p.material.uniforms.global_scale.value=e}));const n=k.addFolder("transforms");n.add(E,"scale_x",0,1).step(1e-5).name("scale_x").onChange((function(e){p.material.uniforms.df_scale.value=new a.Pa4(e,E.scale_y,E.scale_z)})),n.add(E,"scale_y",0,1).step(1e-5).name("scale_y").onChange((function(e){p.material.uniforms.df_scale.value=new a.Pa4(E.scale_x,e,E.scale_z)})),n.add(E,"scale_z",0,1).step(1e-5).name("scale_z").onChange((function(e){p.material.uniforms.df_scale.value=new a.Pa4(E.scale_x,E.scale_y,e)})),n.add(E,"rot_x",-360,360).step(.1).name("rotate_x").onChange((function(e){p.material.uniforms.df_rot.value=new a.Pa4(e,E.rot_y,E.rot_z)})),n.add(E,"rot_y",-360,360).step(.1).name("rotate_y").onChange((function(e){p.material.uniforms.df_rot.value=new a.Pa4(E.rot_x,e,E.rot_z)})),n.add(E,"rot_z",-360,360).step(.1).name("rotate_z").onChange((function(e){p.material.uniforms.df_rot.value=new a.Pa4(E.rot_x,E.rot_y,e)})),n.add(E,"translation_x").step(.01).name("translate_x").onChange((function(e){p.material.uniforms.df_translation.value=new a.Pa4(e,E.translation_y,E.translation_z)})),n.add(E,"translation_y").step(.01).name("translate_y").onChange((function(e){p.material.uniforms.df_translation.value=new a.Pa4(E.translation_x,e,E.translation_z)})),n.add(E,"translation_z").step(.01).name("translate_z").onChange((function(e){p.material.uniforms.df_translation.value=new a.Pa4(E.translation_x,E.translation_y,e)}));const t=k.addFolder("color");t.add(E,"color_mode",{Presets:0,Gradient:1,Unicolor:2}).name("color_mode").onChange((function(e){p.material.uniforms.color_mode.value=e})),t.add(E,"color_preset_type",0,4).step(1).name("color_preset").onChange((function(e){p.material.uniforms.color_preset_type.value=e})),t.add(E,"color_space",{RBG:0,HSV:1}).name("color_space").onChange((function(e){p.material.uniforms.color_space.value=e})),t.addColor(E,"uni_color").name("unicolor").onChange((function(e){p.material.uniforms.uni_color.value=new a.Ilk(e)})),t.addColor(E,"color_1").name("color_1").onChange((function(e){p.material.uniforms.color_1.value=new a.Ilk(e)})),t.addColor(E,"color_2").name("color_2").onChange((function(e){p.material.uniforms.color_2.value=new a.Ilk(e)})),k.addFolder("spectrogram").add(E,"mel_spec_bins",10,96).step(1).name("mel_spec_bins").onChange((function(e){w=e}));const o=k.addFolder("raycasting");o.add(E,"dt_scale",.005).step(.001).name("dt_scale").onChange((function(e){p.material.uniforms.dt_scale.value=e})),o.add(E,"max_steps",1).step(1).name("max_steps").onChange((function(e){p.material.uniforms.max_steps.value=e}))}(),h=new a.SUY;let n=new a._12(2,2),t=new a.vBJ({map:H(4,4),side:a.ehD});m=new a.Kj0(n,t),m.position.set(-2,0,-1),v=H(z,w);const r=function(e){const n=new a.YT8([new a.Pa4(0,0,-.5),new a.Pa4(0,0,-.25),new a.Pa4(0,0,0),new a.Pa4(0,0,.25),new a.Pa4(0,0,.5)]),t=n.getSpacedPoints(5),o=n.computeFrenetFrames(5,!0);return b={positions:t,tangents:o.tangents,normals:o.normals,binormals:o.binormals,numPoints:5},n}().getPoints(5),x=(new a.u9r).setFromPoints(r),y=new a.nls({color:16711680});g=new a.x12(x,y),g.matrixAutoUpdate=!1;const A=new a.DvJ(1,1,1),C={volume_scale:{value:new a.Pa4(1,1,1)},volume:{value:V(4,4,4)},volume_dims:{value:new a.Pa4(4,4,4)},min_dist:{value:E.min_dist},max_dist:{value:E.max_dist},color_mode:{value:E.color_mode},color_preset_type:{value:E.color_preset_type},color_space:{value:E.color_space},uni_color:{value:new a.Ilk(E.uni_color)},color_1:{value:new a.Ilk(E.color_1)},color_2:{value:new a.Ilk(E.color_2)},aabb_min:{value:new a.Pa4},aabb_max:{value:new a.Pa4},dt_scale:{value:E.dt_scale},max_steps:{value:E.max_steps},spectrum:{value:H(4,4)},curve_data:{value:Y(b)},time:{value:h.getElapsedTime()},playback_progress:{value:0},df_sphere_tube:{value:E.df_sphere_tube},df_sphere_box:{value:E.df_sphere_box},df_sphere_plane:{value:E.df_sphere_plane},df_tube_box:{value:E.df_tube_box},df_tube_plane:{value:E.df_tube_plane},df_plane_box:{value:E.df_plane_box},playback_rate:{value:1},df_translation:{value:new a.Pa4(E.translation_x,E.translation_y,E.translation_z)},df_rot:{value:new a.Pa4(E.rot_x,E.rot_y,E.rot_z)},df_scale:{value:new a.Pa4(E.scale_x,E.scale_y,E.scale_z)},global_scale:{value:E.global_scale},df_type:{value:0}},P=new a.jyz({uniforms:C,vertexShader:"\nuniform vec3 volume_scale;\nout vec3 vray_dir;\nflat out vec3 transformed_eye;\n\nvoid main(void) {\n\tvec3 volume_translation = vec3(0.5) - volume_scale * 0.5;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1);\n\ttransformed_eye = (cameraPosition - volume_translation) / volume_scale;\n\tvray_dir = position - transformed_eye;\n}",fragmentShader:"\nprecision highp int;\nprecision highp float;\nin vec3 vray_dir;\nflat in vec3 transformed_eye;\nconst float Epsilon = 1e-10;\n// Scene\nuniform highp sampler3D volume;\nuniform highp sampler2D spectrum;\nuniform highp sampler2D curve_data;\nuniform vec3 aabb_min;\nuniform vec3 aabb_max;\n\n// playback \nuniform float time;\nuniform float playback_progress;\nuniform float playback_rate;\n\n//distance field \nuniform int df_type;\nuniform vec3 df_scale;\nuniform float global_scale;\nuniform float df_sphere_tube;\nuniform float df_sphere_box;\nuniform float df_sphere_plane;\nuniform float df_tube_box;\nuniform float df_tube_plane;\nuniform float df_plane_box;\nuniform vec3 df_rot;\nuniform vec3 df_translation;\nuniform float min_dist;\nuniform float max_dist;\n\n// raycasting volume\nuniform float dt_scale;\nuniform int max_steps;\nuniform ivec3 volume_dims;\nuniform vec3 volume_scale;\nuniform int color_space;\nuniform int color_mode;\nuniform int color_preset_type;\nuniform vec3 uni_color;\nuniform vec3 color_1;\nuniform vec3 color_2;\n\n\n// Axis-Aligned Bounding Box intersection\nvec2 intersect_box(vec3 aabbMin, vec3 aabbMax, vec3 orig, vec3 dir) {\n\n\tvec3 inv_dir = 1.0 / dir;\n\tvec3 tmin_tmp = (aabbMin - orig) * inv_dir;\n\tvec3 tmax_tmp = (aabbMax - orig) * inv_dir;\n\tvec3 tmin = min(tmin_tmp, tmax_tmp);\n\tvec3 tmax = max(tmin_tmp, tmax_tmp);\n\tfloat t0 = max(tmin.x, max(tmin.y, tmin.z));\n\tfloat t1 = min(tmax.x, min(tmax.y, tmax.z));\n\treturn vec2(t0, t1);\n}\n// Color conversions\n// from: http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-gls\nvec3 rgb2hsv(vec3 c) {\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n  c = vec3(c.x, clamp(c.yz, 0.0, 1.0));\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nfloat linear_to_srgb(float x) {\n\tif (x <= 0.0031308f) {\n\t\treturn 12.92f * x;\n\t}\n\treturn 1.055f * pow(x, 1.f / 2.4f) - 0.055f;\n}\n\n// Clamping\nfloat smoothClamp(float x, float a, float b)\n{\n    return smoothstep(0., 1., (x - a)/(b - a))*(b - a) + a;\n}\n\nfloat softClamp(float x, float a, float b)\n{\n    return smoothstep(0., 1., (2./3.)*(x - a)/(b - a) + (1./6.))*(b - a) + a;\n}\n\nfloat sdSphere( vec3 p, vec3 offset, float scale )\n{\n  float dist = length(p - offset) - scale;\n  return 1.0 - clamp(dist, 0.0, 1.0);\n}\n\nfloat sdPlane( vec3 p, vec3 n, float h )\n{\n  // n must be normalized\n  return dot(p,n) + h;\n}\n\nfloat sdRoundBox( vec3 p, vec3 b, float r )\n{\n  vec3 q = abs(p) - b;\n  return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0) - r;\n}\n\n//3d rotation: https://gist.github.com/yiwenl/3f804e80d0930e34a0b33359259b556c\nmat4 rotationMatrix(vec3 axis, float angle) {\n  axis = normalize(axis);\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1.0 - c;\n  \n  return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n              oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n              oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n              0.0,                                0.0,                                0.0,                                1.0);\n}\n\nvec3 rotate(vec3 v, vec3 axis, float angle) {\n  mat4 m = rotationMatrix(axis, angle);\n  return (m * vec4(v, 1.0)).xyz;\n}\n\nvoid main(void) {\n\tvec3 ray_dir = normalize(vray_dir);\n\tvec2 t_hit = intersect_box(aabb_min, aabb_max, transformed_eye, ray_dir);\n\n\tif (t_hit.x > t_hit.y) {\n\t\tdiscard;\n\t}\n\n\tt_hit.x = max(t_hit.x, 0.0);\n\tvec3 dt_vec = 1.0 / (vec3(volume_dims) * abs(ray_dir));\n\tfloat dt = dt_scale * min(dt_vec.x, min(dt_vec.y, dt_vec.z));\n\tvec3 p = transformed_eye + (t_hit.x + dt) * ray_dir;\n\n  vec4 spec_val = texture(spectrum, vec2(0.0, 0.0));\n  spec_val.rgba = vec4(0.0);\n\n  // Frequency coordinate\n  float u_coords = 0.0;\n  // Time coordinate\n  float v_coords = 0.0;\n\n  float dist = 0.0;\n\n  int step = 0;\n\tfor (float t = t_hit.x; t < t_hit.y; t += dt) {\n    if (step > max_steps){\n      break;\n    }\n\n    // position used for distance field calculation\n    vec3 p_dist = p;\n    vec3 p_dist_r = vec3(0.0);\n    vec3 p_dist_t = vec3(0.0);\n    vec3 p_dist_r_t = vec3(0.0);\n\n    // rotate\n    p_dist_r = rotate(p_dist, vec3(1.0, 0.0, 0.0) , radians( df_rot.x));\n    p_dist_r = rotate(p_dist_r, vec3(0.0, 1.0, 0.0) , radians( df_rot.y));\n    p_dist_r = rotate(p_dist_r, vec3(0.0, 0.0, 1.0) , radians( df_rot.z));\n\n    // translate\n    p_dist_t = p_dist - df_translation;\n    \n    // rotate then translate \n    p_dist_r_t = p_dist_r - df_translation;\n\n    // distance function\n    // sphere\n    float dist_sphere = clamp(length(p_dist_r_t), 0.0, 1.0);\n    float u_coords_sphere = playback_progress;\n\n    // tube\n    float dist_tube = length(p_dist_r_t.xy);\n    float u_coords_tube = (p_dist_r_t.z - 0.5) / playback_rate + 1.;\n\n    // plane\n    // normal vector \n    vec3 plane_n = vec3(0.0);\n    plane_n = rotate(vec3(0.0,1.0,0.0), vec3(1.0, 0.0, 0.0) , radians( df_rot.x));\n    plane_n = rotate(plane_n, vec3(0.0, 1.0, 0.0) , radians( df_rot.y));\n    plane_n = rotate(plane_n, vec3(0.0, 0.0, 1.0) , radians( df_rot.z));\n    float dist_plane = dot(p_dist_t, plane_n);\n    float u_coords_plane = playback_progress;\n\n    // round box \n    float dist_box = sdRoundBox(p_dist_r_t, df_scale * global_scale * 1.3, 0.0);\n    float u_coords_box = u_coords_sphere;\n\n    // Interpolate between distance functions\n    if(df_type ==  0){\n      u_coords =  mix(u_coords_sphere, u_coords_tube, df_sphere_tube);\n      dist =  mix(dist_sphere, dist_tube, df_sphere_tube);\n    }\n    else if ( df_type == 1){\n      u_coords =  mix(u_coords_sphere, u_coords_box, df_sphere_box);\n      dist =  mix(dist_sphere, dist_box, df_sphere_box);      \n    }\n    else if ( df_type == 2){\n      u_coords =  mix(u_coords_sphere, u_coords_plane, df_sphere_plane);\n      dist =  mix(dist_sphere, dist_plane, df_sphere_plane);         \n    }\n    else if ( df_type == 3){\n      u_coords =  mix(u_coords_tube, u_coords_box, df_tube_box);\n      dist =  mix(dist_tube, dist_box, df_tube_box);   \n    }\n    else if (df_type == 4){\n      u_coords =  mix(u_coords_tube, u_coords_plane, df_tube_plane);\n      dist =  mix(dist_tube, dist_plane, df_tube_plane);   \n    }\n    else if (df_type == 5){\n      u_coords =  mix(u_coords_plane, u_coords_box, df_plane_box);\n      dist =  mix(dist_plane, dist_box, df_plane_box);   \n    }\n  \n    v_coords = length(df_scale) * global_scale / max(pow(dist,2.0), Epsilon);\n\n    spec_val = texture(spectrum, vec2(u_coords, v_coords));\n\n    // THREE.js sets values outside texture borders(outside the [0,1] x [0,1] range) \n    // to the values at the borders\n    // This an undesired effect for our purposes so we set those values \n    // to zero. \n    if (u_coords < 0. || u_coords > 1. || \n      v_coords < 0. || v_coords > 1.){\n      spec_val = vec4(0.0);\n    }\n    // Soft Clamp values\n    if (dist < min_dist || dist > max_dist){\n      spec_val *= softClamp(dist - max_dist, 0., 1.);\n    }\n    vec4 val_color = vec4(0.0);\n\n    float mixValue = max(dist, Epsilon);\n    vec3 mix_color = vec3(0.0);\n    if (color_mode == 0) {\n      // Use color presets\n      vec4 preset_color = vec4(pow(spec_val.r,10.0) * 1./dist,\n      pow(spec_val.r, 2.0),\n      pow(spec_val.r, 0.0) * 1./dist, spec_val.r) ;\n\n      // swizzle color components to define presets\n      if ( color_preset_type == 0){\n        val_color = preset_color.xyzw;\n      }\n      if ( color_preset_type == 1){\n        val_color = preset_color.zxyw;\n      }\n      else if(color_preset_type == 2) {\n        val_color = preset_color.zyxw;\n      }\n      else if(color_preset_type == 3) {\n        val_color = preset_color.xzyw;\n      }\n      else if(color_preset_type == 4) {\n        val_color = preset_color.yxzw;\n      }\n    }\n    else if (color_mode == 1) {\n      // Use color  gradient\n      if (color_space == 0) {\n        // mix color in rgb space\n        mix_color = mix(color_1, color_2, mixValue);\n      }\n      else if (color_space == 1) {\n        // Mix color in  hsv space\n        vec3 hsv1 = rgb2hsv(color_1);\n        vec3 hsv2 = rgb2hsv(color_2);\n        float hue = (mod(mod((hsv2.x - hsv1.x), 1.) + 1.5, 1.) - 0.5) * mixValue + hsv1.x;\n        vec3 hsv = vec3(hue, mix(hsv1.yz, hsv2.yz, mixValue));\n        mix_color = hsv2rgb(hsv);\n      }\n      val_color = vec4(mix_color, spec_val.r);\n    }\n    else if (color_mode == 2) {\n      // Use unique color\n\n      val_color = vec4(\n        pow(spec_val.r, (1.0 - uni_color.x) * 10.0), \n        pow(spec_val.r, (1.0 - uni_color.y) * 10.0), \n        pow(spec_val.r, (1.0 - uni_color.z) * 10.0), \n        spec_val.r);\n        val_color.xyz *= 1.0 / max(dist, Epsilon);\n    }\n    // Opacity correction\n    val_color.w = 1.0 - pow(1.0 - val_color.w, dt_scale);\n\n    // Alpha-blending\n    gl_FragColor.rgb += (1.0 - gl_FragColor.a) * val_color.w * val_color.xyz;\n    gl_FragColor.a += (1.0 - gl_FragColor.a) * val_color.w;\n    if (gl_FragColor.a > 0.99) {\n      break;\n    }\n    if (val_color.w < 0.0) {\n      discard;\n    }\n    // step along the ray direction\n\t\tp += ray_dir * dt;\n    step++;\n\t}\n\n  gl_FragColor.r = linear_to_srgb(gl_FragColor.r);\n  gl_FragColor.g = linear_to_srgb(gl_FragColor.g);\n  gl_FragColor.b = linear_to_srgb(gl_FragColor.b);\n\n  //gl_FragColor = color;\n\n}\n",side:a.ehD,transparent:!0});p=new a.Kj0(A,P),p.matrixAutoUpdate=!0,p.geometry.computeBoundingBox(),p.material.uniforms.aabb_min.value=p.geometry.boundingBox.min,p.material.uniforms.aabb_max.value=p.geometry.boundingBox.max,l.add(p),f=new a.FM8,window.addEventListener("pointerMove",K);const F=new a._12(25,25),T=new a.vBJ({visible:!1});u=new a.Kj0(F,T),u.rotation.x=-.5*Math.PI,_=new a.iMs,D(),document.addEventListener("pointermove",K),window.addEventListener("resize",N),q.addEventListener("click",G),O.addEventListener("play",$),O.addEventListener("pause",Z),L.addEventListener("change",(()=>{var e;e=L,O.src=I.createObjectURL(e.files[0]),O.load()})),W.addEventListener("click",(e=>{"BUTTON"===e.target.nodeName&&(O.src=i[e.target.id],O.load())}))}(),function e(){requestAnimationFrame(e),ee(),p.material.uniforms.time.value=h.getElapsedTime(),p.material.uniforms.curve_data.value=function(e,n){const t=e.geometry.attributes.position.array,o=Array(5);let r=0;for(let e=0;e<5;e++)o[e]=4==e?new a.Pa4(t[r+0],t[r+1]+Math.abs(Math.sin(h.getElapsedTime())),t[r+2]):new a.Pa4(t[r+0],t[r+1],t[r+2]),r+=3;const i=new a.YT8(o),s=i.getSpacedPoints(5),l=i.computeFrenetFrames(5,!0);return b={positions:s,tangents:l.tangents,normals:l.normals,binormals:l.binormals,numPoints:5},Y(b)}(g),p.material.uniforms.playback_progress.value=O.currentTime/O.duration,D()}()}},t={};function a(e){var o=t[e];if(void 0!==o)return o.exports;var r=t[e]={exports:{}};return n[e].call(r.exports,r,r.exports,a),r.exports}a.m=n,e=[],a.O=(n,t,o,r)=>{if(!t){var i=1/0;for(d=0;d<e.length;d++){for(var[t,o,r]=e[d],s=!0,l=0;l<t.length;l++)(!1&r||i>=r)&&Object.keys(a.O).every((e=>a.O[e](t[l])))?t.splice(l--,1):(s=!1,r<i&&(i=r));if(s){e.splice(d--,1);var c=o();void 0!==c&&(n=c)}}return n}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[t,o,r]},a.d=(e,n)=>{for(var t in n)a.o(n,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},a.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),a.p="/hyperstep/",(()=>{var e={414:0};a.O.j=n=>0===e[n];var n=(n,t)=>{var o,r,[i,s,l]=t,c=0;if(i.some((n=>0!==e[n]))){for(o in s)a.o(s,o)&&(a.m[o]=s[o]);if(l)var d=l(a)}for(n&&n(t);c<i.length;c++)r=i[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},t=self.webpackChunk=self.webpackChunk||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var o=a.O(void 0,[365,133],(()=>a(301)));o=a.O(o)})();
//# sourceMappingURL=bundle.f2b1c25ca786eaebdb79.js.map