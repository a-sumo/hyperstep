(()=>{var e,t={761:(e,t,n)=>{"use strict";var i=n(9477),r=n(9365),a=n(5079),o=n(4327),s=n(2524);let c,l,d,u,m,h,p,v,f,w,_,g,y,b,x;!1===o.Z.isWebGL2Available()&&document.body.appendChild(o.Z.getWebGL2ErrorMessage());let A,P,E,M,F={};Object.defineProperty(F,"__esModule",{value:!0}),F.AudioReader=class{constructor(e){if("Float32Array"!=e.type())throw"This class requires a ring buffer of Float32Array";this.ringbuf=e}dequeue(e){return this.ringbuf.empty()?0:this.ringbuf.pop(e)}available_read(){return this.ringbuf.available_read()}},F.AudioWriter=class{constructor(e){if("Float32Array"!=e.type())throw"This class requires a ring buffer of Float32Array";this.ringbuf=e}enqueue(e){return this.ringbuf.push(e)}available_write(){return this.ringbuf.available_write()}},F.ParameterReader=class{constructor(e){this.ringbuf=e,this.mem=new ArrayBuffer(5),this.array=new Uint8Array(this.mem),this.view=new DataView(this.mem)}dequeue_change(e){return!this.ringbuf.empty()&&(this.ringbuf.pop(this.array),e.index=this.view.getUint8(0),e.value=this.view.getFloat32(1),!0)}},F.ParameterWriter=class{constructor(e){if("Uint8Array"!=e.type())throw"This class requires a ring buffer of Uint8Array";this.ringbuf=e,this.mem=new ArrayBuffer(5),this.array=new Uint8Array(this.mem),this.view=new DataView(this.mem)}enqueue_change(e,t){return this.view.setUint8(0,e),this.view.setFloat32(1,t),!(this.ringbuf.available_write()<5)&&5==this.ringbuf.push(this.array)}},F.RingBuffer=class{static getStorageForCapacity(e,t){if(!t.BYTES_PER_ELEMENT)throw"Pass in a ArrayBuffer subclass";var n=8+(e+1)*t.BYTES_PER_ELEMENT;return new SharedArrayBuffer(n)}constructor(e,t){if(!ArrayBuffer.__proto__.isPrototypeOf(t)&&void 0!==t.BYTES_PER_ELEMENT)throw"Pass a concrete typed array class as second argument";this._type=t,this.capacity=(e.byteLength-8)/t.BYTES_PER_ELEMENT,this.buf=e,this.write_ptr=new Uint32Array(this.buf,0,1),this.read_ptr=new Uint32Array(this.buf,4,1),this.storage=new t(this.buf,8,this.capacity)}type(){return this._type.name}push(e){var t=Atomics.load(this.read_ptr,0),n=Atomics.load(this.write_ptr,0);if((n+1)%this._storage_capacity()==t)return 0;let i=Math.min(this._available_write(t,n),e.length),r=Math.min(this._storage_capacity()-n,i),a=i-r;return this._copy(e,0,this.storage,n,r),this._copy(e,r,this.storage,0,a),Atomics.store(this.write_ptr,0,(n+i)%this._storage_capacity()),i}pop(e){var t=Atomics.load(this.read_ptr,0),n=Atomics.load(this.write_ptr,0);if(n==t)return 0;let i=Math.min(this._available_read(t,n),e.length),r=Math.min(this._storage_capacity()-t,e.length),a=i-r;return this._copy(this.storage,t,e,0,r),this._copy(this.storage,0,e,r,a),Atomics.store(this.read_ptr,0,(t+i)%this._storage_capacity()),i}empty(){var e=Atomics.load(this.read_ptr,0);return Atomics.load(this.write_ptr,0)==e}full(){var e=Atomics.load(this.read_ptr,0);return(Atomics.load(this.write_ptr,0)+1)%this.capacity!=e}capacity(){return this.capacity-1}available_read(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_read(e,t)}available_write(){var e=Atomics.load(this.read_ptr,0),t=Atomics.load(this.write_ptr,0);return this._available_write(e,t)}_available_read(e,t){return t>e?t-e:t+this._storage_capacity()-e}_available_write(e,t){let n=e-t-1;return t>=e&&(n+=this._storage_capacity()),n}_storage_capacity(){return this.capacity}_copy(e,t,n,i,r){for(var a=0;a<r;a++)n[i+a]=e[t+a]}},F.deinterleave=function(e,t){var n=e.length/256;if(t.length!=n)throw"not enough space in output arrays";for(var i=0;i<channelCount;i++){let a=t[i],o=i;for(var r=0;r<128;++r)a[r]=e[o],o+=n}},F.interleave=function(e,t){if(128*e.length!=t.length)throw"input and output of incompatible sizes";for(var n=0,i=0;i<128;i++)for(;j<t.length;j++)t[n]=e[0][i],n++};try{b=window.AudioContext||window.webkitAudioContext,x=new b}catch(e){throw"Could not instantiate AudioContext: "+e.message}const T={canvas:document.createElement("canvas"),movingWindowWidth:350,get wPixelRatio(){return this.layoutWidth/this.canvas.width},get hPixelRatio(){return this.layoutHeight/this.canvas.height},layoutWidth:700,layoutHeight:288,isFull:!1,offset:50,cursor:0,spectrumAccum:[],init:function(){this.canvas.width=this.movingWindowWidth,this.canvas.height=96,this.canvas.style.width=`${this.layoutWidth}px`,this.canvas.style.height=`${this.layoutHeight}px`,this.canvas.style.backgroundColor="transparent",this.ctx=this.canvas.getContext("2d")},resetState:function(){this.cursor=0,this.isFull=!1,this.canvas.width=this.movingWindowWidth;let e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),t=e.data;t=t.fill(0),this.ctx.putImageData(e,0,0),this.spectrumAccum=[]}};let S,k;document.getElementById("axesDiv"),T.offset,T.offset,T.layoutHeight;let B=navigator;void 0===B.mediaDevices&&(B.mediaDevices={});const O=document.getElementById("loadFileInput"),W=document.getElementById("recordButton");function D(){c.aspect=window.innerWidth/window.innerHeight,c.updateProjectionMatrix(),d.setSize(window.innerWidth,window.innerHeight),R()}function U(e){w.x=e.clientX/window.innerWidth*2-1,w.y=-e.clientY/window.innerHeight*2+1}function z(e,t,n){const r=new Uint8Array(e*t*n*4);let a=0;for(let i=0;i<n;i++)for(let o=0;o<t;o++)for(let s=0;s<e;s++)r[a+0]=s/e*255,r[a+1]=o/t*255,r[a+2]=i/n*255,r[a+3]=255,a+=4;const o=new i.JUT(r,e,t,n);return o.format=i.wk1,o.unpackAlignment=1,o.needsUpdate=!0,o}function C(e,t){const n=new Float32Array(e*t*4);let r=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++)n[r+0]=1,n[r+1]=0,n[r+2]=0,n[r+3]=1,r+=4;const a=new i.IEO(n,e,t);return a.format=i.wk1,a.type=i.VzW,a.minFilter=i.TyD,a.magFilter=i.TyD,a.unpackAlignment=1,a.needsUpdate=!0,a}function L(e){const t=new Float32Array(4*e.numPoints*4);let n=0;const r=[e.positions,e.tangents,e.normals,e.binormals];for(let i=0;i<4;i++)for(let a=0;a<e.numPoints;a++)t[n+0]=r[i][a].x,t[n+1]=r[i][a].y,t[n+2]=r[i][a].z,t[n+3]=1,n+=4;const a=new i.IEO(t,e.numPoints,1);return a.type=i.VzW,a.format=i.wk1,a.minFilter=i.TyD,a.magFilter=i.TyD,a.unpackAlignment=1,a.needsUpdate=!0,a}function R(){d.render(l,c)}function q(){W.classList.contains("recording")?stopMicRecordStream():(W.setAttribute("disabled",!0),function(){if(!navigator.mediaDevices.getUserMedia)throw"Could not access microphone - getUserMedia not available";console.log("Initializing audio..."),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(I).catch((function(e){throw"Could not access microphone - "+e}))}())}function I(e){if(A=e,!A.active)throw"Mic stream not active";"closed"==x.state?x=new b:"suspended"==x.state&&x.resume(),P=x.createMediaStreamSource(A),E=x.createGain(),E.gain.setValueAtTime(0,x.currentTime),function(e){const t=["https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia-wasm.umd.js","https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia.js-extractor.umd.js","https://raw.githack.com/MTG/essentia.js/master/examples/demos/melspectrogram-rt/melspectrogram-processor.js","https://unpkg.com/ringbuf.js@0.1.0/dist/index.js"].map((e=>fetch(e).then((e=>e.text()))));return Promise.all(t).then((e=>{e.unshift("var exports = {};");const t=e.join(""),n=new Blob([t],{type:"text/javascript"});return URL.createObjectURL(n)}))}().then((e=>{x.audioWorklet.addModule(e).then(H).catch((function(e){console.log(`There was a problem loading the AudioWorklet module code: \n ${e}`)}))})).catch((e=>{console.log(`There was a problem retrieving the AudioWorklet module code: \n ${e}`)})),W.classList.add("recording"),W.innerHTML="STOP",W.setAttribute("disabled",!1)}function H(){let e=F.RingBuffer.getStorageForCapacity(1728,Float32Array),t=new F.RingBuffer(e,Float32Array);k=new F.AudioReader(t),M=new AudioWorkletNode(x,"melspectrogram-processor",{processorOptions:{bufferSize:1024,hopSize:512,melNumBands:96,sampleRate:x.sampleRate}});try{M.port.postMessage({sab:e})}catch(e){return alert("No SharedArrayBuffer transfer support, try another browser."),void W.setAttribute("disabled",!0)}P.connect(M),M.connect(E),E.connect(x.destination),requestAnimationFrame(N)}let V,Y;function N(e){void 0===V&&(V=e),Y=e-V,S=requestAnimationFrame(N);let t=new Float32Array(96);k.available_read()>=96&&0!==k.dequeue(t)&&t.map((e=>Math.round(35.5*e)))}addEventListener("change",(()=>{return e=O,(0,s.lj)(e.files[0]).then((e=>async function(e){const t=await(0,s.qn)(e);return(0,s.ZP)((0,s.k5)(t,{sampleRate:16e3,hopLength:512,nMels:229,nFft:2048,fMin:30}))}(e))).then((e=>function(e,t,n){const r=new Float32Array(t*n*4);let a=0;for(let i=0;i<n;i++)for(let n=0;n<t;n++)r[a+0]=e[n][i],r[a+1]=0,r[a+2]=0,r[a+3]=0,a+=4;for(var o=-1/0,s=1/0,c=0;c<r.length;c++)r[c]>o&&(o=r[c]);for(c=0;c<r.length;c++)r[c]<s&&(s=r[c]);for(a=0;a<t*n*4;)r[a]=(r[a]-s)/(o-s),a+=4;const l=new i.IEO(r,t,n);return l.format=i.wk1,l.type=i.VzW,l.minFilter=i.TyD,l.magFilter=i.TyD,l.unpackAlignment=1,l.needsUpdate=!0,l}(e,e.length,229))).then((e=>{return t=e,v.material.map=t,v.material.dispose(),f.material.uniforms.spectrum.value=t,void f.material.dispose();var t}));var e})),function(){l=new i.xsS,d=new i.CP7({antialias:!0}),d.setPixelRatio(window.devicePixelRatio),d.setSize(window.innerWidth,window.innerHeight);const e=window.innerWidth/window.innerHeight;c=new i.cPb(45,e,.01,1e3),c.position.set(0,0,10),l.add(c),u=new r.z(c,d.domElement),u.addEventListener("change",R),u.minZoom=.1,u.maxZoom=10,u.enablePan=!1,u.update();let t=new i._12(2,2),n=new i.vBJ({map:C(4,4),side:i.ehD});v=new i.Kj0(t,n),v.position.set(-2,0,-1),l.add(v);const o=new i.DvJ(1,1,1);_=new i.SUY;const s=function(e){const t=new i.YT8([new i.Pa4(0,0,-.5),new i.Pa4(0,0,-.25),new i.Pa4(0,0,0),new i.Pa4(0,0,.25),new i.Pa4(0,0,.5)]),n=t.getSpacedPoints(5),r=t.computeFrenetFrames(5,!0);return y={positions:n,tangents:r.tangents,normals:r.normals,binormals:r.binormals,numPoints:5},t}().getPoints(5),b=(new i.u9r).setFromPoints(s),x=new i.nls({color:16711680});g=new i.x12(b,x),g.matrixAutoUpdate=!1,l.add(g);const A={volume_scale:{value:new i.Pa4(1,1,1)},volume:{value:z(4,4,4)},volume_dims:{value:new i.Pa4(4,4,4)},aabb_min:{value:new i.Pa4},aabb_max:{value:new i.Pa4},dt_scale:{value:.1},spectrum:{value:C(100,1024)},curve_data:{value:L(y)},time:{value:_.getElapsedTime()}},P=new i.jyz({uniforms:A,vertexShader:"\nuniform vec3 volume_scale;\nout vec3 vray_dir;\nflat out vec3 transformed_eye;\nvoid main(void) {\n // TODO: For non-uniform size volumes we need to transform them differently as well\n // to center them properly\n vec3 volume_translation = vec3(0.5) - volume_scale * 0.5;\n gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1);\n transformed_eye = (cameraPosition - volume_translation) / volume_scale;\n vray_dir = position - transformed_eye;\n}",fragmentShader:"\nprecision highp int;\nprecision highp float;\nuniform highp sampler3D volume;\nuniform highp sampler2D spectrum;\nuniform highp sampler2D curve_data;\nuniform ivec3 volume_dims;\nuniform vec3 volume_scale;\nuniform float dt_scale;\nuniform vec3 aabb_min;\nuniform vec3 aabb_max;\nuniform float time;\nin vec3 vray_dir;\nflat in vec3 transformed_eye;\n \nvec2 intersect_box(vec3 aabbMin, vec3 aabbMax, vec3 orig, vec3 dir) {\n \n vec3 inv_dir = 1.0 / dir;\n vec3 tmin_tmp = (aabbMin - orig) * inv_dir;\n vec3 tmax_tmp = (aabbMax - orig) * inv_dir;\n vec3 tmin = min(tmin_tmp, tmax_tmp);\n vec3 tmax = max(tmin_tmp, tmax_tmp);\n float t0 = max(tmin.x, max(tmin.y, tmin.z));\n float t1 = min(tmax.x, min(tmax.y, tmax.z));\n return vec2(t0, t1);\n}\n// Pseudo-random number gen from\n// http://www.reedbeta.com/blog/quick-and-easy-gpu-random-numbers-in-d3d11/\n// with some tweaks for the range of values\nfloat wang_hash(int seed) {\n seed = (seed ^ 61) ^ (seed >> 16);\n seed *= 9;\n seed = seed ^ (seed >> 4);\n seed *= 0x27d4eb2d;\n seed = seed ^ (seed >> 15);\n return float(seed % 2147483647) / float(2147483647);\n}\nfloat linear_to_srgb(float x) {\n if (x <= 0.0031308f) {\n   return 12.92f * x;\n }\n return 1.055f * pow(x, 1.f / 2.4f) - 0.055f;\n}\nvec4 color_transfer(float intensity)\n{\n vec3 high = vec3(0.0, 0.0, 0.0);\n vec3 low = vec3(1.0, 1.0, 1.0);\n float alpha = (exp(intensity) - 1.0) / (exp(1.0) - 1.0);\n return vec4(intensity * high + (1.0 - intensity) * low, alpha);\n}\n \nfloat sdSphere( vec3 p, vec3 offset, float scale )\n{\n float dist = length(p - offset) - scale;\n return 1.0 - clamp(dist, 0.0, 1.0);\n}\nfloat distCurve(vec3 p){\n float min_dist = 10.0;\n float du = 0.2;\n float u = 0.0;\n while(u < 1.0 ){\n   vec2 v_pos = vec2(u, 0.0);\n   // point normals are stored in the 3rd row of the texture\n   // whose UV.v coordinate is 0.75\n   vec2 v_norm = vec2(u, 0.75);\n   vec3 dir_vec = p - texture(curve_data, v_pos).rgb ;\n \n   min_dist = min(min_dist, length(dir_vec));\n   u += du;\n }\n \n return min_dist;\n}\n \nvoid main(void) {\n vec3 ray_dir = normalize(vray_dir);\n vec4 color = vec4(0.0);\n vec2 t_hit = intersect_box(aabb_min, aabb_max, transformed_eye, ray_dir);\n if (t_hit.x > t_hit.y) {\n   discard;\n }\n t_hit.x = max(t_hit.x, 0.0);\n vec3 dt_vec = 1.0 / (vec3(volume_dims) * abs(ray_dir));\n float dt = dt_scale * min(dt_vec.x, min(dt_vec.y, dt_vec.z));\n vec3 p = transformed_eye + (t_hit.x + dt) * ray_dir;\n int step = 0;\n int maxStep = 100 ;\n for (float t = t_hit.x; t < t_hit.y; t += dt) {\n   if (step > maxStep){\n     break;\n   }\n   // use distance function\n   // infinite tube\n   float dist = length(p.xy) - 0.01;\n   // sphere\n   // float dist = clamp(length(p), 0.0, 1.0);\n   // curve\n   // float dist = distCurve(p) * 1.0;\n   // sample spectrogram\n   vec4 spec_val = texture(spectrum, vec2(0.5,  0.03 / dist));\n   vec4 val_color = vec4(pow(spec_val.r,10.0) ,pow(spec_val.r, 2.0),0.0 * pow(spec_val.r,0.0),spec_val.r);\n   //vec4 val_color = vec4(pow(dist,8.0),dist,dist,dist);\n   // Opacity correction\n   val_color.w = 1.0 - pow(1.0 - val_color.w, dt_scale);\n \n   // Alpha-blending\n   color.xyz += (1.0 - color.w) * val_color.w * val_color.xyz;\n   color.w += (1.0 - color.w) * val_color.w;\n   // if (color.w > 0.99) {\n   //   break;\n   // }\n   if (val_color.w < 0.0) {\n     discard;\n   }\n   p += ray_dir * dt;\n   step++;\n }\n color.x = linear_to_srgb(color.x);\n color.y = linear_to_srgb(color.y);\n color.z = linear_to_srgb(color.z);\n gl_FragColor = color;\n //gl_FragColor = vec4(texture(spectrum,vec2(0.0,0.0)).rgb * 255.0, 1.0);\n \n}\n",side:i.ehD,transparent:!0});f=new i.Kj0(o,P),f.matrixAutoUpdate=!0,f.geometry.computeBoundingBox(),f.material.uniforms.aabb_min.value=f.geometry.boundingBox.min,f.material.uniforms.aabb_max.value=f.geometry.boundingBox.max,l.add(f),w=new i.FM8,window.addEventListener("pointerMove",U);const E=new i._12(25,25),M=new i.vBJ({visible:!1});p=new i.Kj0(E,M),p.rotation.x=-.5*Math.PI,l.add(p),p.name="plane",h=new i.iMs,function(e){const t=new i.VLJ(10,10);e.add(t),m=(0,a.Z)(),document.body.appendChild(m.dom);const n=new i.y8_(3);e.add(n)}(l),R(),document.addEventListener("pointermove",U),window.addEventListener("resize",D),W.addEventListener("click",q)}(),function e(){requestAnimationFrame(e),f.material.uniforms.time.value=_.getElapsedTime(),f.material.uniforms.curve_data.value=function(e,t){const n=e.geometry.attributes.position.array,r=Array(5);let a=0;for(let e=0;e<5;e++)r[e]=4==e?new i.Pa4(n[a+0],n[a+1]+Math.abs(Math.sin(_.getElapsedTime())),n[a+2]):new i.Pa4(n[a+0],n[a+1],n[a+2]),a+=3;const o=new i.YT8(r),s=o.getSpacedPoints(5),c=o.computeFrenetFrames(5,!0);return y={positions:s,tangents:c.tangents,normals:c.normals,binormals:c.binormals,numPoints:5},L(y)}(g),m.update(),R()}()},6470:()=>{},5751:()=>{},4673:()=>{},3522:()=>{},7159:()=>{},2664:()=>{},2967:()=>{}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=t,i.amdD=function(){throw new Error("define cannot be used indirect")},i.amdO={},e=[],i.O=(t,n,r,a)=>{if(!n){var o=1/0;for(d=0;d<e.length;d++){for(var[n,r,a]=e[d],s=!0,c=0;c<n.length;c++)(!1&a||o>=a)&&Object.keys(i.O).every((e=>i.O[e](n[c])))?n.splice(c--,1):(s=!1,a<o&&(o=a));if(s){e.splice(d--,1);var l=r();void 0!==l&&(t=l)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,r,a]},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={947:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var r,a,[o,s,c]=n,l=0;if(o.some((t=>0!==e[t]))){for(r in s)i.o(s,r)&&(i.m[r]=s[r]);if(c)var d=c(i)}for(t&&t(n);l<o.length;l++)a=o[l],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(d)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=i.O(void 0,[365,53,124],(()=>i(761)));r=i.O(r)})();
//# sourceMappingURL=bundle.f5934ba79370f44fcfe4.js.map